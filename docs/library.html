<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Library search | Comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS</title>
  <meta name="description" content="SSANTA." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Library search | Comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://www.oru.se/personal/thanh_wang" />
  <meta property="og:image" content="https://www.oru.se/personal/thanh_wang/images/OUR.png" />
  <meta property="og:description" content="SSANTA." />
  <meta name="github-repo" content="WBS-TW/WBS-TW.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Library search | Comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS" />
  
  <meta name="twitter:description" content="SSANTA." />
  <meta name="twitter:image" content="https://www.oru.se/personal/thanh_wang/images/OUR.png" />

<meta name="author" content="Thanh Wang,   MTM Research Centre, Örebro University" />


<meta name="date" content="2021-06-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="molecular-networks.html"/>
<link rel="next" href="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.6.1/grViz.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SSA/NTA</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="Intro.html"><a href="Intro.html"><i class="fa fa-check"></i><b>1</b> <strong>Introduction and concepts</strong></a>
<ul>
<li class="chapter" data-level="1.1" data-path="Intro.html"><a href="Intro.html#terminologies"><i class="fa fa-check"></i><b>1.1</b> Terminologies</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Exp-design.html"><a href="Exp-design.html"><i class="fa fa-check"></i><b>2</b> <strong>Experimental design</strong></a>
<ul>
<li class="chapter" data-level="2.1" data-path="Exp-design.html"><a href="Exp-design.html#hypothesis"><i class="fa fa-check"></i><b>2.1</b> Hypothesis</a></li>
<li class="chapter" data-level="2.2" data-path="Exp-design.html"><a href="Exp-design.html#experimental-design"><i class="fa fa-check"></i><b>2.2</b> Experimental design</a></li>
<li class="chapter" data-level="2.3" data-path="Exp-design.html"><a href="Exp-design.html#qaqc-measures"><i class="fa fa-check"></i><b>2.3</b> QA/QC measures</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="Exp-design.html"><a href="Exp-design.html#recovery-extraction-efficieny"><i class="fa fa-check"></i><b>2.3.1</b> Recovery (Extraction efficieny)</a></li>
<li class="chapter" data-level="2.3.2" data-path="Exp-design.html"><a href="Exp-design.html#matrix-effects"><i class="fa fa-check"></i><b>2.3.2</b> Matrix effects</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="Exp-design.html"><a href="Exp-design.html#data-directory-structure"><i class="fa fa-check"></i><b>2.4</b> Data directory structure</a></li>
<li class="chapter" data-level="2.5" data-path="Exp-design.html"><a href="Exp-design.html#sampling-design-and-collection"><i class="fa fa-check"></i><b>2.5</b> Sampling design and collection</a></li>
<li class="chapter" data-level="2.6" data-path="Exp-design.html"><a href="Exp-design.html#collection-of-metadata"><i class="fa fa-check"></i><b>2.6</b> Collection of metadata</a></li>
<li class="chapter" data-level="2.7" data-path="Exp-design.html"><a href="Exp-design.html#chemical-analysis"><i class="fa fa-check"></i><b>2.7</b> Chemical analysis</a></li>
<li class="chapter" data-level="2.8" data-path="Exp-design.html"><a href="Exp-design.html#data-analysis"><i class="fa fa-check"></i><b>2.8</b> Data analysis</a></li>
<li class="chapter" data-level="2.9" data-path="Exp-design.html"><a href="Exp-design.html#workflow-examples"><i class="fa fa-check"></i><b>2.9</b> Workflow examples</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="MS-preprocess.html"><a href="MS-preprocess.html"><i class="fa fa-check"></i><b>3</b> <strong>Pre-processing HRMS data</strong></a>
<ul>
<li class="chapter" data-level="3.1" data-path="MS-preprocess.html"><a href="MS-preprocess.html#peak-picking"><i class="fa fa-check"></i><b>3.1</b> Peak picking</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html"><i class="fa fa-check"></i><b>4</b> Open tools for preprocessing</a>
<ul>
<li class="chapter" data-level="4.1" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#openms-and-toppview"><i class="fa fa-check"></i><b>4.1</b> OpenMS and Toppview</a></li>
<li class="chapter" data-level="4.2" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#msnbase-and-xcms"><i class="fa fa-check"></i><b>4.2</b> MsnBase and XCMS</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#xcms"><i class="fa fa-check"></i><b>4.2.1</b> XCMS</a></li>
<li class="chapter" data-level="4.2.2" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#camera"><i class="fa fa-check"></i><b>4.2.2</b> CAMERA</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#patroon"><i class="fa fa-check"></i><b>4.3</b> PatRoon</a></li>
<li class="chapter" data-level="4.4" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#ms-dial"><i class="fa fa-check"></i><b>4.4</b> MS-DIAL</a></li>
<li class="chapter" data-level="4.5" data-path="open-tools-for-preprocessing.html"><a href="open-tools-for-preprocessing.html#output-formats"><i class="fa fa-check"></i><b>4.5</b> Output formats</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="suspect-screening.html"><a href="suspect-screening.html"><i class="fa fa-check"></i><b>5</b> <strong>Suspect screening</strong></a>
<ul>
<li class="chapter" data-level="5.1" data-path="suspect-screening.html"><a href="suspect-screening.html#lib2nist"><i class="fa fa-check"></i><b>5.1</b> LIB2NIST</a></li>
<li class="chapter" data-level="5.2" data-path="suspect-screening.html"><a href="suspect-screening.html#listing-suspects"><i class="fa fa-check"></i><b>5.2</b> Listing suspects</a></li>
<li class="chapter" data-level="5.3" data-path="suspect-screening.html"><a href="suspect-screening.html#suspect-scoring"><i class="fa fa-check"></i><b>5.3</b> Suspect scoring</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mass-defect.html"><a href="mass-defect.html"><i class="fa fa-check"></i><b>6</b> <strong>Mass defect plots</strong></a>
<ul>
<li class="chapter" data-level="6.1" data-path="mass-defect.html"><a href="mass-defect.html#mdplotr"><i class="fa fa-check"></i><b>6.1</b> MDPlotR</a></li>
<li class="chapter" data-level="6.2" data-path="mass-defect.html"><a href="mass-defect.html#findhalo"><i class="fa fa-check"></i><b>6.2</b> findhalo</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="retention-times.html"><a href="retention-times.html"><i class="fa fa-check"></i><b>7</b> <strong>Retention time index and prediction</strong></a>
<ul>
<li class="chapter" data-level="7.1" data-path="retention-times.html"><a href="retention-times.html#lc"><i class="fa fa-check"></i><b>7.1</b> LC</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="retention-times.html"><a href="retention-times.html#retip---retention-time-prediction-for-metabolomics"><i class="fa fa-check"></i><b>7.1.1</b> Retip - Retention Time prediction for Metabolomics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="molecular-networks.html"><a href="molecular-networks.html"><i class="fa fa-check"></i><b>8</b> <strong>Molecular networks</strong></a>
<ul>
<li class="chapter" data-level="8.1" data-path="molecular-networks.html"><a href="molecular-networks.html#metgem"><i class="fa fa-check"></i><b>8.1</b> MetGem</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="molecular-networks.html"><a href="molecular-networks.html#gc-data"><i class="fa fa-check"></i><b>8.1.1</b> GC data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="library.html"><a href="library.html"><i class="fa fa-check"></i><b>9</b> <strong>Library search</strong></a>
<ul>
<li class="chapter" data-level="9.0.1" data-path="library.html"><a href="library.html#sirius-csi-fingerid"><i class="fa fa-check"></i><b>9.0.1</b> Sirius CSI FingerID</a></li>
<li class="chapter" data-level="9.0.2" data-path="library.html"><a href="library.html#cfm-id"><i class="fa fa-check"></i><b>9.0.2</b> CFM-ID</a></li>
<li class="chapter" data-level="9.1" data-path="library.html"><a href="library.html#neims"><i class="fa fa-check"></i><b>9.1</b> NEIMS</a></li>
<li class="chapter" data-level="9.2" data-path="library.html"><a href="library.html#deepei"><i class="fa fa-check"></i><b>9.2</b> DeepEI</a></li>
<li class="chapter" data-level="9.3" data-path="library.html"><a href="library.html#qceims"><i class="fa fa-check"></i><b>9.3</b> QCEIMS</a></li>
<li class="chapter" data-level="9.4" data-path="library.html"><a href="library.html#gc-orbitrap-hrms-workflow"><i class="fa fa-check"></i><b>9.4</b> <strong>GC orbitrap HRMS workflow</strong></a></li>
<li class="chapter" data-level="9.5" data-path="library.html"><a href="library.html#lc-hrms-using-waters-mse-dia-workflow"><i class="fa fa-check"></i><b>9.5</b> <strong>LC-HRMS using Waters MSe DIA workflow</strong></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html"><a href="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html"><i class="fa fa-check"></i><b>10</b> Workflow for centroiding of raw file, peak picking and correlation of MS1 and MS2</a>
<ul>
<li class="chapter" data-level="10.1" data-path="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html"><a href="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html#first-convert-unifi-data-using-msconvert"><i class="fa fa-check"></i><b>10.1</b> First convert unifi data using MSConvert</a></li>
<li class="chapter" data-level="10.2" data-path="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html"><a href="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html#centroiding-raw-data-from-mzml-using-msnbase"><i class="fa fa-check"></i><b>10.2</b> Centroiding raw data from mzML using MSnbase</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="example-pfas.html"><a href="example-pfas.html"><i class="fa fa-check"></i><b>11</b> Example workflow: PFASs</a></li>
<li class="chapter" data-level="12" data-path="mtm-hrms-library-gc-hrms.html"><a href="mtm-hrms-library-gc-hrms.html"><i class="fa fa-check"></i><b>12</b> MTM HRMS Library: GC-HRMS</a>
<ul>
<li class="chapter" data-level="12.1" data-path="mtm-hrms-library-gc-hrms.html"><a href="mtm-hrms-library-gc-hrms.html#analyze-the-standards-using-hrms"><i class="fa fa-check"></i><b>12.1</b> Analyze the standards using HRMS</a></li>
<li class="chapter" data-level="12.2" data-path="mtm-hrms-library-gc-hrms.html"><a href="mtm-hrms-library-gc-hrms.html#convert-the-raw-data-file-from-gc-hrms-analysis-to-.mzml-using-msconvert-for-unifi-conversion-see-section-xx"><i class="fa fa-check"></i><b>12.2</b> Convert the raw data file from GC-HRMS analysis to .mzML using MSconvert (For unifi conversion, see section XX)</a></li>
<li class="chapter" data-level="12.3" data-path="mtm-hrms-library-gc-hrms.html"><a href="mtm-hrms-library-gc-hrms.html#fill-in-the-standard-infosheet"><i class="fa fa-check"></i><b>12.3</b> Fill in the standard infosheet</a></li>
<li class="chapter" data-level="12.4" data-path="mtm-hrms-library-gc-hrms.html"><a href="mtm-hrms-library-gc-hrms.html#use-md-dial-to-perform-spectral-deconvolution-and-generate-spectra-for-each-compound"><i class="fa fa-check"></i><b>12.4</b> Use MD-DIAL to perform spectral deconvolution and generate spectra for each compound</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="mtm-hrms-library-lc-hrms-in-mse-mode.html"><a href="mtm-hrms-library-lc-hrms-in-mse-mode.html"><i class="fa fa-check"></i><b>13</b> MTM HRMS Library: LC-HRMS in MSe mode</a>
<ul>
<li class="chapter" data-level="13.1" data-path="mtm-hrms-library-lc-hrms-in-mse-mode.html"><a href="mtm-hrms-library-lc-hrms-in-mse-mode.html#analyze-the-standards-using-hrms-1"><i class="fa fa-check"></i><b>13.1</b> Analyze the standards using HRMS</a></li>
<li class="chapter" data-level="13.2" data-path="mtm-hrms-library-lc-hrms-in-mse-mode.html"><a href="mtm-hrms-library-lc-hrms-in-mse-mode.html#convert-the-raw-data-file-from-lc-hrms-in-unifi-to-mzml-using-msconvert"><i class="fa fa-check"></i><b>13.2</b> Convert the raw data file from LC-HRMS in unifi to mzML using MSconvert</a></li>
<li class="chapter" data-level="13.3" data-path="mtm-hrms-library-lc-hrms-in-mse-mode.html"><a href="mtm-hrms-library-lc-hrms-in-mse-mode.html#fill-in-the-standard-infosheet-1"><i class="fa fa-check"></i><b>13.3</b> Fill in the standard infosheet</a></li>
<li class="chapter" data-level="13.4" data-path="mtm-hrms-library-lc-hrms-in-mse-mode.html"><a href="mtm-hrms-library-lc-hrms-in-mse-mode.html#use-md-dial-to-perform-spectral-deconvolution-and-generate-spectra-for-each-compound-1"><i class="fa fa-check"></i><b>13.4</b> Use MD-DIAL to perform spectral deconvolution and generate spectra for each compound</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="a-handbook-on-gc-q-exactive-orbitrap-use.html"><a href="a-handbook-on-gc-q-exactive-orbitrap-use.html"><i class="fa fa-check"></i><b>14</b> A handbook on GC Q Exactive orbitrap use</a>
<ul>
<li class="chapter" data-level="14.1" data-path="a-handbook-on-gc-q-exactive-orbitrap-use.html"><a href="a-handbook-on-gc-q-exactive-orbitrap-use.html#terminologies-1"><i class="fa fa-check"></i><b>14.1</b> Terminologies</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="library" class="section level1" number="9">
<h1><span class="header-section-number">9</span> <strong>Library search</strong></h1>
<p>In environmental analysis, NIST MS library is widely used to match a spectrum to a list of standard spectra. However, a major drawback of the NIST MS Search is that now all chemicals are included and all spectral ions are at unit mass (for EI spectra library, also called mainlib)</p>
<p>Below figure shows a relatively good spectral match for a standard if only nominal or even at 0.1 decimal m/z:</p>
<div class="figure"><span id="fig:spectrum1"></span>
<img src="images/Spectra_CFBP_MePDA.PNG" alt="Spectral matching (using MS-DIAL)" width="696" />
<p class="caption">
Figure 9.1: Spectral matching (using MS-DIAL)
</p>
</div>
<p><br><br><br />
## IN SILICO FRAGMENTATION</p>
<p>There are three different models that have recently been published to prdict the fragmentation patterns of GC-EI MS.</p>
<p><br><br>
### MEtfrag
<br><br></p>
<div id="sirius-csi-fingerid" class="section level3" number="9.0.1">
<h3><span class="header-section-number">9.0.1</span> Sirius CSI FingerID</h3>
<p><br><br></p>
</div>
<div id="cfm-id" class="section level3" number="9.0.2">
<h3><span class="header-section-number">9.0.2</span> CFM-ID</h3>
<p>In silico fragmentation:<br />
Help file: <a href="https://sourceforge.net/p/cfm-id/wiki/Home/" class="uri">https://sourceforge.net/p/cfm-id/wiki/Home/</a></p>
<p><br>
<em>Use instructions:</em></p>
<ul>
<li>If you are using EI-MS (GC-MS) data, please use the ei_ms_model provided.<br />
</li>
<li>Note that lpsolve55.dll must also be included in the same directory as the executables. This file can be found in the development version of LPSolve (e.g. lp_solve_5.5.2.0_dev_win32.zip), which can be downloaded from <a href="https://sourceforge.net/projects/lpsolve/files/lpsolve/5.5.2.5/lp_solve_5.5.2.5_dev_win32.zip/download" class="uri">https://sourceforge.net/projects/lpsolve/files/lpsolve/5.5.2.5/lp_solve_5.5.2.5_dev_win32.zip/download</a>.</li>
</ul>
<p>Cfm-predict</p>
<p>COMMAND:<br />
<code>cfm-predict.exe &lt;smiles_or_inchi_or_file&gt; &lt;prob_thresh&gt; &lt;param_file&gt; &lt;config_file&gt; &lt;annotate_fragments&gt; &lt;output_file_or_dir&gt; &lt;apply_postproc&gt; &lt;suppress_exceptions&gt;</code></p>
<p><br></p>
<p>EXAMPLE (naphthalene):<br />
<code>cfm-predict.exe InChI=1S/C10H8/c1-2-6-10-8-4-3-7-9(10)5-1/h1-8H 0.001 D:/Program/cfm-id-2.4_win32/ei_nn_iso_new/param_output.log D:/Program/cfm-id-2.4_win32/ei_nn_iso_new/param_config.txt 0 D:/Program/cfm-id-2.4_win32/test/output.msp</code></p>
<p><br></p>
<p>EXAMPLE (.txt file as input):<br />
<code>cfm-predict.exe D:/Program/cfm-id-2.4_win32/test/input.txt 0.001 D:/Program/cfm-id-2.4_win32/ei_nn_iso_new/param_output.log D:/Program/cfm-id-2.4_win32/ei_nn_iso_new/param_config.txt 0 D:/Program/cfm-id-2.4_win32/test/output.msp</code></p>
<p><br><br><br></p>
</div>
<div id="neims" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> NEIMS</h2>
<p>Help files: <a href="https://github.com/brain-research/deep-molecular-massspec" class="uri">https://github.com/brain-research/deep-molecular-massspec</a></p>
<p><br><br><br></p>
</div>
<div id="deepei" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> DeepEI</h2>
<p>Help files: <a href="https://github.com/hcji/DeepEI" class="uri">https://github.com/hcji/DeepEI</a><br />
<a href="https://github.com/hcji/DeepEI/blob/master/Usage.ipynb" class="uri">https://github.com/hcji/DeepEI/blob/master/Usage.ipynb</a></p>
<p><br><br><br></p>
</div>
<div id="qceims" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> QCEIMS</h2>
<p>RUN ON LINUX SERVER</p>
<p>Check <a href="https://www.chemie.uni-bonn.de/pctc/mulliken-center/software/movies_grimme/QCEIMS.v.4.0_manual.pdf">online manual</a> for details</p>
<p>PREPARATION<br />
Copy the “.XTBPARAM” folder and the “.mass_raw.agr” file to /home/ORUNET.ORU.SE/twg/</p>
<ol style="list-style-type: decimal">
<li>Prepare a file with the equilibrium structure of your desired molecule M.
Important: This file has to be named coord and should have the TURBOMOLE coord format (tmol).
In most cases you will have an .xyz file. This file can be easily converted by typing:</li>
</ol>
<blockquote>
<p>x2t <xyzfile> &gt; coord</p>
</blockquote>
<p>if you have installed TURBOMOLE. If you do not have TURBOMOLE, you may have to write a
script converting .xyz files to TUROBOMOLE coord files. Be advised that the coord file has
to be in atomic units.<br />
NOTE: this can be converted using openbabel -&gt; tmol</p>
<ol start="2" style="list-style-type: decimal">
<li>Prepare an input file called qceims.in. For the input options, see section 4 or the
qceims.in file in the examples folder. If no such file is prepared, default options are:
run GFN1-xTB with 25 times the number of atoms in the molecule trajectories (ntraj).</li>
</ol>
<p>RUN QCEIMS</p>
<pre><code>1. set +o noclobber

2. export PATH=/home/ORUNET.ORU.SE/twg/QCEIMS/:/home/ORUNET.ORU.SE/twg/bin:/home/ORUNET.ORU.SE/twg/.local/bin:/bin:/usr/bin:/opt/thinlinc/bin:/usr/local/bin:/usr/bin/X11:/sbin:/usr/sbin:/usr/local/sbin:/snap/bin:/opt/thinlinc/bin:/opt/SPAdes/SPAdes-3.13.0-Linux/bin:/opt/mauve/mauve_snapshot_2015-02-13:/opt/parsnp/Parsnp-Linux64-v1.2:/opt/prokka/prokka-master/bin:/opt/artemis/artemis

3. cd QCEIMS/example/ethanol

4. qceims
run qceims again and check the ouput if all is ok.

5. Executing production runs.
Running qceims locally, use:
pqceims &lt;#cores&gt;
where &lt;#cores&gt; is the number of cores requested
You might want to leave your work station and even log out in the meantime. In this case, type:
nohup pqceims &lt;# proc&gt; &amp;

Optionally, check the status of your QCEIMS run by changing to your working directory
and typing getres, which will provide an output of the form:
XXX runs done and written to tmpqceims.res/out
getres
which gathers the runs already finished (creates tmpqceims.res and tmpqceims.out). 
The final results are on qceims.out and qceims.res

6. download an exp. EI-MS from the NIST if available and copy it to the working dir as exp.dat 
(take the JCAMP-DX format from their web page).  - Usefull for testing but not necessary. -

7. get spectrum by 
plotms
and plot it with
xmgrace mass.agr
the file &quot;.mass.agr&quot; should be in your home dir.
plotms reads by default &lt;qceims.res&gt; or by
plotms -f &lt;name_of_res_file&gt;
any other res file. Check the consistency of the total charge.

8. if the ratio of fragment to M+ signals is too large decrease the IEE by increasing the parameter 
ieeatm (default is 0.6 eV/atom) by inserting
ieeatm  &lt;value&gt;
in qceims.in and do the parallel run again (requires an additional qceims pre-run).

9. if the IEE is ok, increase ntraj to get better statistics and re-run 
(note: qceims.res is appended so delete it at this point).

VERY IMPORTANT: EVERY CHANGE IN THE INPUT REQUIRES A RUN OF QCEIMS IN THE WORKING DIR
BEFORE THE PARALLEL SCRIPT IS STARTED IN ORDER TO BE IN EFFECT!

10. trajectories are in TMPQCEIMS/TMP.&lt;run_number&gt;
they are numbered by the run and the ion tracking number.
(something like gmolden TMPQCEIMS/TMP.$1/trj.$1.$2
gives trajectory $1, track $2)

11. for more QCEIMS code options (model parameters) see manual

usefull options for qceims:

-c     : check IEE but do nothing (requires M trajectory)
-p     : normal production (fragmentation) mode. Possible in any
         existing TMPQCEIMS/TMP.$1 directory.
-eonly : use the requested QC (as specified in qceims.in)
         and do a single-point energy 
-e0    : same as above, charge = 0
-e1    : same as above, charge = 1
-qcp &lt;string&gt;
       : string = path to the QC code /usr/local/bin is default)

other important options in &lt;qceims.in&gt;:

ip-&lt;method&gt;
ntraj &lt;int&gt;
ieeatm &lt;real&gt;
iseed &lt;int&gt;     (random number initialization to start different runs)
  
## LIBRARY SEARCH  
xx



  
  
### LIB2NIST  
Convert your library list into NIST library format using LIB2NIST command line (in order to preserve the accurate mass). See command line help file for arguments.  
  
COMMAND:  
`lib2nist.exe /log9 Mylib.log /OutLib /StdRounding:N /MsmsOnly:Y /AccuratePeakMZ /PrecurMzDecPlaces=keep /PeakMzDecPlaces=keep /UseSubset:N &lt;path to msp file&gt; &lt;output path&gt; =&lt;new name of library&gt;`  
    
EXAMPLES:  
`lib2nist64.exe /log9 Mylib.log /OutLib /StdRounding:N /MsmsOnly:Y /AccuratePeakMZ /PrecurMzDecPlaces=keep /PeakMzDecPlaces=keep /UseSubset:N D:\Projects\Suspect_lists\Spectral_databases\RECETOX_GC-EI_MS_20201028.msp D:\Program\NIST14\ =RECETOX_GC-EI_MS_20201028`  
  
&lt;br&gt;&lt;br&gt;&lt;br&gt;

### MSPepSearch  
    
Use MSPepSearch to find similar spectra  
  
  
EXAMPLES:  
`MSPepSearch64.exe Gusviqh /ZI 0.1 /ZIPPM 20 /MPPM 30 /MzLimits 50 -1 /MinMF 10 /OnlyFound /HITS 5 /LIB D:\Raw_data\Dust_Florian\GC\test\Mylib /INP D:\Raw_data\Dust_Florian\GC\test\input.msp /OUTMGF D:\Raw_data\Dust_Florian\GC\test\test.mgf /OUTTAB D:\Raw_data\Dust_Florian\GC\test\test.tsv /OutMW`
  
  
`MSPepSearch64.exe Gusviqh /ZI 0.1 /ZIPPM 20 /MPPM 30 /MzLimits 50 -1 /MinMF 100 /OnlyFound /HITS 5 /LIB C:\NIST14\NIST_contaminants_orbitrap /INP D:\Projects\Mexico_Air\NIST_Mexico.msp /OUTMGF D:\Projects\Mexico_Air\test\test.mgf /OUTTAB D:\Projects\Mexico_Air\test\test.tsv`  
  
  
`MSPepSearch64.exe Gusviqh /ZI 0.01 /ZIPPM 10 /MPPM 10 /MzLimits 50 -1 /MinMF 500 /OnlyFound /HITS 5 /LIB C:\NIST14\LCMs_GC_Orbitrap /INP D:\Raw_data\Dust_Florian\GC\test\11.msp /OUTMGF D:\Raw_data\Dust_Florian\GC\test\test.mgf /OUTTAB D:\Raw_data\Dust_Florian\GC\test\test.tsv`  






&lt;!--chapter:end:08-library_search.Rmd--&gt;

# **Data post-processing** {#postprocessing}



&lt;br&gt;&lt;br&gt;  
## Classyfire  





## Hierarchical clustering  

&lt;!--chapter:end:09-data_post_processing.Rmd--&gt;

# Example workflow: indoor dust {#example_dust}

A walkthrough for indoor dust analysis

&lt;br&gt;&lt;br&gt;  




&lt;div class=&quot;figure&quot; style=&quot;text-align: center&quot;&gt;

```{=html}
&lt;div id=&quot;htmlwidget-944a1785ac4963b4c23c&quot; style=&quot;width:672px;height:480px;&quot; class=&quot;grViz html-widget&quot;&gt;&lt;/div&gt;
&lt;script type=&quot;application/json&quot; data-for=&quot;htmlwidget-944a1785ac4963b4c23c&quot;&gt;{&quot;x&quot;:{&quot;diagram&quot;:&quot;\ndigraph Scheme {\n      \n# graph statement\ngraph [layout = dot, overlap = false, rankdir = LR]\n\n# node statements\nnode [shape = box,\nfontname = Helvetica, fontsize = 35, style = filled]\n      \nnode [color = black, fillcolor = white, fixedsize = false]\n# A [label = \&quot;Indoor dust collected \\n among different \\n use categories\&quot;]\n# \n# node [color = black, fillcolor = white, fixedsize = false]\n# B1 [label = \&quot;Collect different groups\&quot;]\n# B2 [label = \&quot;QA/QC\&quot;]\n# \n# \n# node [color = black, fillcolor = white, fixedsize = false]\n# C1 [label = \&quot;Sample different groups\&quot;]\n# C2 [label = \&quot;Suspect list of Cl/Br compounds\&quot;]\n\nnode [color = black, fillcolor = white, fixedsize = false]\nD1 [label = \&quot;Sample extraction\&quot;]\nD1_1 [label = \&quot;Hexane 3 mL\&quot;]\nD1_2 [label = \&quot;Hexane: Acetone (1:1) 3 mL\&quot;]\nD1_3 [label = \&quot;Toluene 3 mL\&quot;]\nD2 [label = \&quot;Combine and split 1:1\&quot;]\nD3_1 [label = \&quot;GC\&quot;]\nD3_2 [label = \&quot;LC\&quot;]\nD4 [label = \&quot;split 1:1\&quot;]\n\n\n\nE1 [label = \&quot;GC-HRMS\&quot;]\nE2 [label = \&quot;LC-HRMS\&quot;]\n# \n# \n# node [color = black, fillcolor = white, fixedsize = false]\n# F1 [label = \&quot;Suspect screening\&quot;]\n# F2 [label = \&quot;Nontarget\&quot;]\n# \n# G1 [label = \&quot;Mass defect plots\&quot;]\n\n      \n      \n# edge statements\nedge [color = black]\n# A -&gt; {B1}\n# B2 -&gt; {C1}\n# B1 -&gt; {C1 C2}\n# C1 -&gt; {D1}\n\nD1 -&gt; {D1_1}\nD1_1 -&gt; {D1_2}\nD1_2 -&gt; {D1_3}\nD1_1 -&gt; {D2}\nD1_2 -&gt; {D2}\nD2 -&gt; {D3_1}\nD2 -&gt; {D3_2}\nD3_1 -&gt; {D4}\nD1_3 -&gt; {D4}\n\nD3_2 -&gt; {E2}\nD4 -&gt; {E1}\nD1_3 -&gt; {E1}\n      \n      }\n      &quot;,&quot;config&quot;:{&quot;engine&quot;:&quot;dot&quot;,&quot;options&quot;:null}},&quot;evals&quot;:[],&quot;jsHooks&quot;:[]}&lt;/script&gt;</code></pre>
<p class="caption">
(#fig:example_workflows_dust)Workflow for nontarget using XX
</p>
</div>
<div id="htmlwidget-aff30042729cc554b85f" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-aff30042729cc554b85f">{"x":{"diagram":"\ndigraph Scheme {\n      \n# graph statement\ngraph [layout = dot, overlap = false]\n\n# node statements\nnode [shape = box,\nfontname = Helvetica, fontsize = 35, style = filled]\n      \nnode [color = black, fillcolor = white, fixedsize = false]\n\nZERO [label = \"Deconvolution\"]\n\nA [label = \"Target analysis\"]\nB [label = \"Suspect list screening\"]\n\nC [label = \"NIST library screening\"]\nC1 [label = \"Molecular ion confirmation\"]\nC2 [label = \"Retention time index\"]\n\n\nD [label = \"Mass defect \\n (selected mz, rt and int of annotated compounds\"]\n\nsubgraph cluster2 {\nE [label = \"Annotation\"]\nID1 [label = \"Confirm EIC peaks\"]\n}\n\nF [label = \"Molecular networking\"]\nG [label = \"Multivariate statistics\"]\n\nID2 [label = \"Peak/Component list with \\n partial annotation\"]\n\nQ1 [label = \"Semiquantify across samples\"]      \n      \n# edge statements\n\nedge [color = black]\n\nZERO -> {A B C}\nA -> {E}\nB -> {E}\n\n{C1 C2} -> {C}\nC -> {E}\n\nE -> {ID1}\nID1 -> {ID2}\nID2 -> {F}\nID2 -> {G}\nID2 -> {D}\nID2 -> {Q1}\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p><br></p>
</div>
<div id="gc-orbitrap-hrms-workflow" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> <strong>GC orbitrap HRMS workflow</strong></h2>
<p>This code uses XCMS with MF -&gt; CAMERA preprocessing used in : Stettin, D.; Poulin, R.X.; Pohnert, G. Metabolomics Benefits from Orbitrap GC–MS—Comparison of Low- and High-Resolution GC–MS. Metabolites 2020, 10, 143. See the supplementary material for original code. The code was modified here to also include retention time index and also remove zero intensity peaks after peak grouping. Additional metainformation for the msp file can also be added in the “extra” object.</p>
<p><br></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="library.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(processx)</span>
<span id="cb3-2"><a href="library.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xcms)</span>
<span id="cb3-3"><a href="library.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CAMERA)</span>
<span id="cb3-4"><a href="library.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metaMS)</span>
<span id="cb3-5"><a href="library.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-6"><a href="library.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb3-7"><a href="library.html#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="library.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#first define the working directory (folder with experimental group folders inside)</span></span>
<span id="cb3-9"><a href="library.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- list.files(path = &quot;/home/ORUNET.ORU.SE/twg/Dioxinlab/GC-Orbitrap data/Florian/Dust NTA 20200513/mzXML/&quot;,pattern = &quot;.mzXML&quot;, recursive = TRUE, full.names = TRUE)</span></span>
<span id="cb3-10"><a href="library.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove files containing &quot;Hex&quot;, blank samples</span></span>
<span id="cb3-11"><a href="library.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- mzMLfiles[-grep(&quot;Hex&quot;, mzMLfiles)]</span></span>
<span id="cb3-12"><a href="library.html#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="library.html#cb3-13" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;/home/ORUNET.ORU.SE/twg/Windows_home/Dust_Florian/Sample_list_NTA_dust.xlsx&quot;</span>,</span>
<span id="cb3-14"><a href="library.html#cb3-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> <span class="st">&quot;Sample&quot;</span>)</span>
<span id="cb3-15"><a href="library.html#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only samples</span></span>
<span id="cb3-16"><a href="library.html#cb3-16" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb3-17"><a href="library.html#cb3-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;blank_solvent&quot;</span>)))</span>
<span id="cb3-18"><a href="library.html#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="library.html#cb3-19" aria-hidden="true" tabindex="-1"></a>mzXMLfiles <span class="ot">&lt;-</span> <span class="fu">as.character</span>(sample_info<span class="sc">$</span>filename)</span>
<span id="cb3-20"><a href="library.html#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="library.html#cb3-21" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample_name =</span> <span class="fu">paste0</span>(sample_info<span class="sc">$</span>new_codes, <span class="st">&quot;.mzXML&quot;</span>),</span>
<span id="cb3-22"><a href="library.html#cb3-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">class =</span> sample_info<span class="sc">$</span>group,</span>
<span id="cb3-23"><a href="library.html#cb3-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-24"><a href="library.html#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># pd &lt;- pd %&gt;% dplyr::filter(sample_group != &quot;IS&quot;) %&gt;% dplyr::filter(sample_group != &quot;RTI&quot;)</span></span>
<span id="cb3-25"><a href="library.html#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="library.html#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="library.html#cb3-27" aria-hidden="true" tabindex="-1"></a>min.clustersize <span class="ot">&lt;-</span> <span class="dv">17</span> <span class="co">#how many fragments need to be in a group for it to be included in the results. 5 - trace compounds; 20 - mostly high quality spectra</span></span>
<span id="cb3-28"><a href="library.html#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="fu">useOriginalCode</span>(<span class="cn">TRUE</span>) <span class="co">#otherwise matchedFilter will allocate a huge amount of RAM when using step = 0.001</span></span>
<span id="cb3-29"><a href="library.html#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="library.html#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Refer to XCMS and CAMERA documentation for information about parameters and functions</span></span>
<span id="cb3-31"><a href="library.html#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co">#These are the parameters used for high rez GC-Orbitrap data</span></span>
<span id="cb3-32"><a href="library.html#cb3-32" aria-hidden="true" tabindex="-1"></a>xs1 <span class="ot">&lt;-</span> <span class="fu">xcmsSet</span>(mzXMLfiles, </span>
<span id="cb3-33"><a href="library.html#cb3-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">phenoData =</span> pd,</span>
<span id="cb3-34"><a href="library.html#cb3-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;matchedFilter&quot;</span>, </span>
<span id="cb3-35"><a href="library.html#cb3-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">fwhm =</span> <span class="dv">3</span>, <span class="at">step =</span> <span class="fl">0.001</span>, </span>
<span id="cb3-36"><a href="library.html#cb3-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">steps =</span> <span class="dv">2</span>, <span class="at">max =</span> <span class="dv">1000</span>, </span>
<span id="cb3-37"><a href="library.html#cb3-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">snthresh =</span> <span class="dv">3</span>, <span class="at">mzdiff =</span> <span class="fl">0.002</span>)</span>
<span id="cb3-38"><a href="library.html#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="library.html#cb3-39" aria-hidden="true" tabindex="-1"></a>xs2 <span class="ot">&lt;-</span> <span class="fu">group</span>(xs1, <span class="at">method =</span> <span class="st">&quot;density&quot;</span>, <span class="at">bw =</span> <span class="dv">5</span>, <span class="at">mzwid =</span> <span class="fl">0.002</span>, <span class="at">minsamp =</span> <span class="dv">1</span>, <span class="at">minfrac =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1000</span>)</span>
<span id="cb3-40"><a href="library.html#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="library.html#cb3-41" aria-hidden="true" tabindex="-1"></a>xs3 <span class="ot">&lt;-</span> <span class="fu">retcor</span>(xs2, <span class="at">method =</span> <span class="st">&quot;obiwarp&quot;</span>)</span>
<span id="cb3-42"><a href="library.html#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="library.html#cb3-43" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">group</span>(xs3, <span class="at">method =</span> <span class="st">&quot;density&quot;</span>, <span class="at">bw =</span> <span class="dv">2</span>, <span class="at">mzwid =</span> <span class="fl">0.6</span>, <span class="at">minsamp =</span> <span class="dv">1</span>, <span class="at">minfrac =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1000</span>)</span>
<span id="cb3-44"><a href="library.html#cb3-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-45"><a href="library.html#cb3-45" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">group</span>(xs3, <span class="at">method =</span> <span class="st">&quot;density&quot;</span>, <span class="at">bw =</span> <span class="dv">2</span>, <span class="at">mzwid =</span> <span class="fl">0.002</span>, <span class="at">minsamp =</span> <span class="dv">1</span>, <span class="at">minfrac =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1000</span>)</span>
<span id="cb3-46"><a href="library.html#cb3-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-47"><a href="library.html#cb3-47" aria-hidden="true" tabindex="-1"></a>xs5 <span class="ot">&lt;-</span> <span class="fu">fillPeaks</span>(xs4)</span>
<span id="cb3-48"><a href="library.html#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="library.html#cb3-49" aria-hidden="true" tabindex="-1"></a>xs6 <span class="ot">&lt;-</span> <span class="fu">xsAnnotate</span>(<span class="at">xs =</span> xs5, <span class="at">sample=</span><span class="cn">NA</span>, <span class="at">polarity =</span> <span class="st">&quot;positive&quot;</span>)</span>
<span id="cb3-50"><a href="library.html#cb3-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-51"><a href="library.html#cb3-51" aria-hidden="true" tabindex="-1"></a>xs7 <span class="ot">&lt;-</span> <span class="fu">groupFWHM</span>(xs6, <span class="at">sigma =</span> <span class="dv">6</span> , <span class="at">perfwhm =</span> <span class="dv">2</span>, <span class="at">intval =</span> <span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb3-52"><a href="library.html#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="library.html#cb3-53" aria-hidden="true" tabindex="-1"></a>xs8 <span class="ot">&lt;-</span> <span class="fu">groupCorr</span>(xs7, <span class="at">cor_eic_th =</span> <span class="fl">0.8</span>, <span class="at">calcCaS =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-54"><a href="library.html#cb3-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-55"><a href="library.html#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="library.html#cb3-56" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;into&quot;</span>)</span>
<span id="cb3-57"><a href="library.html#cb3-57" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(peaktable, <span class="at">file =</span> <span class="st">&quot;untreated_peaktable_MatchedFilter.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with all m/z features sorted into &quot;compounds&quot;</span></span>
<span id="cb3-58"><a href="library.html#cb3-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-59"><a href="library.html#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="co">#the following script identifies all &quot;compounds&quot; considered too small according to min.clustersize</span></span>
<span id="cb3-60"><a href="library.html#cb3-60" aria-hidden="true" tabindex="-1"></a><span class="co">#you don&#39;t need to modify anything, that run the next part as is</span></span>
<span id="cb3-61"><a href="library.html#cb3-61" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb3-62"><a href="library.html#cb3-62" aria-hidden="true" tabindex="-1"></a>pcgroups <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(peaktable<span class="sc">$</span>pcgroup)))</span>
<span id="cb3-63"><a href="library.html#cb3-63" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-64"><a href="library.html#cb3-64" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-65"><a href="library.html#cb3-65" aria-hidden="true" tabindex="-1"></a>small.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-66"><a href="library.html#cb3-66" aria-hidden="true" tabindex="-1"></a>big.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-67"><a href="library.html#cb3-67" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-68"><a href="library.html#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> pcgroups) {</span>
<span id="cb3-69"><a href="library.html#cb3-69" aria-hidden="true" tabindex="-1"></a>  clustersize <span class="ot">&lt;-</span> <span class="fu">length</span>(peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,<span class="fu">ncol</span>(peaktable)])</span>
<span id="cb3-70"><a href="library.html#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(clustersize <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(min.clustersize))</span>
<span id="cb3-71"><a href="library.html#cb3-71" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb3-72"><a href="library.html#cb3-72" aria-hidden="true" tabindex="-1"></a>    small.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(small.clusters, x)</span>
<span id="cb3-73"><a href="library.html#cb3-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-74"><a href="library.html#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb3-75"><a href="library.html#cb3-75" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb3-76"><a href="library.html#cb3-76" aria-hidden="true" tabindex="-1"></a>    big.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(big.clusters, x)</span>
<span id="cb3-77"><a href="library.html#cb3-77" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,]</span>
<span id="cb3-78"><a href="library.html#cb3-78" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">3</span><span class="sc">-</span>(<span class="fu">length</span>(mzXMLfiles))))]</span>
<span id="cb3-79"><a href="library.html#cb3-79" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">2</span>))]</span>
<span id="cb3-80"><a href="library.html#cb3-80" aria-hidden="true" tabindex="-1"></a>    decider <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-81"><a href="library.html#cb3-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(gruppe1))</span>
<span id="cb3-82"><a href="library.html#cb3-82" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb3-83"><a href="library.html#cb3-83" aria-hidden="true" tabindex="-1"></a>      decider <span class="ot">&lt;-</span> <span class="fu">c</span>(decider, <span class="fu">sum</span>(gruppe1[, i]))</span>
<span id="cb3-84"><a href="library.html#cb3-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-85"><a href="library.html#cb3-85" aria-hidden="true" tabindex="-1"></a>    highest <span class="ot">&lt;-</span> <span class="fu">which</span>(decider<span class="sc">==</span><span class="fu">max</span>(decider), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-86"><a href="library.html#cb3-86" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(gruppe1[, <span class="dv">1</span>], gruppe1[, highest[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb3-87"><a href="library.html#cb3-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(gruppe1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mz&quot;</span>, <span class="st">&quot;int&quot;</span>)</span>
<span id="cb3-88"><a href="library.html#cb3-88" aria-hidden="true" tabindex="-1"></a>    lspectra[[n]] <span class="ot">&lt;-</span> gruppe1</span>
<span id="cb3-89"><a href="library.html#cb3-89" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb3-90"><a href="library.html#cb3-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-91"><a href="library.html#cb3-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-92"><a href="library.html#cb3-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-93"><a href="library.html#cb3-93" aria-hidden="true" tabindex="-1"></a><span class="co"># remove peaks with zero intensities</span></span>
<span id="cb3-94"><a href="library.html#cb3-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-95"><a href="library.html#cb3-95" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lspectra, <span class="cf">function</span>(x) {x[x<span class="sc">$</span>int <span class="sc">!=</span> <span class="dv">0</span>,]})</span>
<span id="cb3-96"><a href="library.html#cb3-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-97"><a href="library.html#cb3-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-98"><a href="library.html#cb3-98" aria-hidden="true" tabindex="-1"></a>reduced.peaktable <span class="ot">&lt;-</span> <span class="fu">getReducedPeaklist</span>(xs8, <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">intval =</span> <span class="st">&quot;into&quot;</span>, <span class="at">default.adduct.info =</span> <span class="st">&quot;maxint&quot;</span>, <span class="at">mzrt.range =</span> <span class="cn">FALSE</span>, <span class="at">npeaks.sum =</span> <span class="cn">FALSE</span>, <span class="at">cleanup =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-99"><a href="library.html#cb3-99" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(small.clusters)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb3-100"><a href="library.html#cb3-100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(z <span class="cf">in</span> small.clusters)</span>
<span id="cb3-101"><a href="library.html#cb3-101" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb3-102"><a href="library.html#cb3-102" aria-hidden="true" tabindex="-1"></a>    reduced.peaktable <span class="ot">&lt;-</span> reduced.peaktable[<span class="sc">-</span>(<span class="fu">which</span>(reduced.peaktable[, <span class="fu">ncol</span>(reduced.peaktable)]<span class="sc">==</span>z)), ]</span>
<span id="cb3-103"><a href="library.html#cb3-103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-104"><a href="library.html#cb3-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-105"><a href="library.html#cb3-105" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(reduced.peaktable, <span class="at">file =</span> <span class="st">&quot;peaktable_MatchedFilter.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with only &quot;compounds&quot; instead of m/z features</span></span>
<span id="cb3-106"><a href="library.html#cb3-106" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="fu">paste</span>(<span class="st">&quot;Unknown&quot;</span>, big.clusters, <span class="st">&quot;RT =&quot;</span>,<span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>) ), <span class="at">Class =</span> <span class="st">&quot;Unknown&quot;</span>, <span class="at">RT =</span> <span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>),  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-107"><a href="library.html#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="library.html#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="do">####KOVATS#####</span></span>
<span id="cb3-109"><a href="library.html#cb3-109" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding Kovats retention index to the extra obejct to write to msp</span></span>
<span id="cb3-110"><a href="library.html#cb3-110" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rt =</span> extra<span class="sc">$</span>RT)</span>
<span id="cb3-111"><a href="library.html#cb3-111" aria-hidden="true" tabindex="-1"></a>alkaneSeries <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Num =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">25</span>),</span>
<span id="cb3-112"><a href="library.html#cb3-112" aria-hidden="true" tabindex="-1"></a>                           <span class="at">rt =</span> <span class="fu">c</span>(<span class="fl">4.90</span>, <span class="fl">8.00</span>, <span class="fl">11.13</span>, <span class="fl">14.05</span>, <span class="fl">16.70</span>, <span class="fl">19.37</span>, <span class="fl">22.45</span>, <span class="fl">25.77</span>))</span>
<span id="cb3-113"><a href="library.html#cb3-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-114"><a href="library.html#cb3-114" aria-hidden="true" tabindex="-1"></a>RI <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="fu">nrow</span>(data))</span>
<span id="cb3-115"><a href="library.html#cb3-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data))) {</span>
<span id="cb3-116"><a href="library.html#cb3-116" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb3-117"><a href="library.html#cb3-117" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">1</span>],</span>
<span id="cb3-118"><a href="library.html#cb3-118" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb3-119"><a href="library.html#cb3-119" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb3-120"><a href="library.html#cb3-120" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb3-121"><a href="library.html#cb3-121" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb3-122"><a href="library.html#cb3-122" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb3-123"><a href="library.html#cb3-123" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>]</span>
<span id="cb3-124"><a href="library.html#cb3-124" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-125"><a href="library.html#cb3-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-126"><a href="library.html#cb3-126" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb3-127"><a href="library.html#cb3-127" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb3-128"><a href="library.html#cb3-128" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb3-129"><a href="library.html#cb3-129" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb3-130"><a href="library.html#cb3-130" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb3-131"><a href="library.html#cb3-131" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb3-132"><a href="library.html#cb3-132" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>],</span>
<span id="cb3-133"><a href="library.html#cb3-133" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">8</span>]</span>
<span id="cb3-134"><a href="library.html#cb3-134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-135"><a href="library.html#cb3-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-136"><a href="library.html#cb3-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-137"><a href="library.html#cb3-137" aria-hidden="true" tabindex="-1"></a>RI[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>n <span class="sc">+</span> <span class="dv">100</span><span class="sc">*</span>(m<span class="sc">-</span>n) <span class="sc">*</span> (data<span class="sc">$</span>rt[i] <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt)<span class="sc">/</span>(alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> m,]<span class="sc">$</span>rt <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt), <span class="dv">0</span>)</span>
<span id="cb3-138"><a href="library.html#cb3-138" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-139"><a href="library.html#cb3-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-140"><a href="library.html#cb3-140" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">cbind</span>(extra, RI)</span>
<span id="cb3-141"><a href="library.html#cb3-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-142"><a href="library.html#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="do">######</span><span class="re">END</span><span class="do"> KOVATS######</span></span>
<span id="cb3-143"><a href="library.html#cb3-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-144"><a href="library.html#cb3-144" aria-hidden="true" tabindex="-1"></a><span class="co"># create the msp object with spectra and all meta information in the extra object (NAME, RETENTIONTIME, RETENTIONINDEX)</span></span>
<span id="cb3-145"><a href="library.html#cb3-145" aria-hidden="true" tabindex="-1"></a>export.msp <span class="ot">&lt;-</span> <span class="fu">construct.msp</span>(lspectra, extra)</span>
<span id="cb3-146"><a href="library.html#cb3-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-147"><a href="library.html#cb3-147" aria-hidden="true" tabindex="-1"></a><span class="fu">write.msp</span>(export.msp, <span class="at">file =</span> <span class="st">&quot;spectra_MatchedFilter20201030.msp&quot;</span>) <span class="co">#This creates a NIST MS Search compatible .msp file with all compound pseudospectra</span></span></code></pre></div>
<p>This code uses XCMS with centWave. Check differences and skip first steps to combine both workflows</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="library.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#first define the working directory (folder with experimental group folders inside)</span></span>
<span id="cb4-2"><a href="library.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- list.files(path = &quot;/mzXML/&quot;,pattern = &quot;.mzXML&quot;, recursive = TRUE, full.names = TRUE)</span></span>
<span id="cb4-3"><a href="library.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove files containing &quot;Hex&quot;, blank samples</span></span>
<span id="cb4-4"><a href="library.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- mzMLfiles[-grep(&quot;Hex&quot;, mzMLfiles)]</span></span>
<span id="cb4-5"><a href="library.html#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="library.html#cb4-6" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;Sample_list_NTA_dust.xlsx&quot;</span>,</span>
<span id="cb4-7"><a href="library.html#cb4-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> <span class="st">&quot;Sample_xcms&quot;</span>)</span>
<span id="cb4-8"><a href="library.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only samples</span></span>
<span id="cb4-9"><a href="library.html#cb4-9" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="library.html#cb4-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;blank_solvent&quot;</span>)))</span>
<span id="cb4-11"><a href="library.html#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="library.html#cb4-12" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample_name =</span> <span class="fu">paste0</span>(sample_info<span class="sc">$</span>analysis, <span class="st">&quot;.mzXML&quot;</span>),</span>
<span id="cb4-13"><a href="library.html#cb4-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sample_group =</span> sample_info<span class="sc">$</span>group,</span>
<span id="cb4-14"><a href="library.html#cb4-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-15"><a href="library.html#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="library.html#cb4-16" aria-hidden="true" tabindex="-1"></a>mzXMLfiles <span class="ot">&lt;-</span> <span class="fu">paste0</span>(sample_info<span class="sc">$</span>path, <span class="st">&quot;/&quot;</span>, sample_info<span class="sc">$</span>analysis, <span class="st">&quot;.mzXML&quot;</span>)</span>
<span id="cb4-17"><a href="library.html#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="library.html#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="library.html#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="library.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Use subset to test</span></span>
<span id="cb4-21"><a href="library.html#cb4-21" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> pd[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,]</span>
<span id="cb4-22"><a href="library.html#cb4-22" aria-hidden="true" tabindex="-1"></a>mzXMLfiles <span class="ot">&lt;-</span> mzXMLfiles[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb4-23"><a href="library.html#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="library.html#cb4-24" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">readMSData</span>(mzXMLfiles, </span>
<span id="cb4-25"><a href="library.html#cb4-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pdata =</span> <span class="fu">new</span>(<span class="st">&quot;NAnnotatedDataFrame&quot;</span>, pd),</span>
<span id="cb4-26"><a href="library.html#cb4-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mode =</span> <span class="st">&quot;onDisk&quot;</span>)</span>
<span id="cb4-27"><a href="library.html#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="library.html#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co"># pd &lt;- pd %&gt;% dplyr::filter(sample_group != &quot;IS&quot;) %&gt;% dplyr::filter(sample_group != &quot;RTI&quot;)</span></span>
<span id="cb4-29"><a href="library.html#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="library.html#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#-----Find features----#</span></span>
<span id="cb4-31"><a href="library.html#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="library.html#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co"># centWave params</span></span>
<span id="cb4-33"><a href="library.html#cb4-33" aria-hidden="true" tabindex="-1"></a>cwp <span class="ot">&lt;-</span> <span class="fu">CentWaveParam</span>(<span class="at">ppm =</span> <span class="dv">5</span>,</span>
<span id="cb4-34"><a href="library.html#cb4-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">peakwidth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">45</span>),</span>
<span id="cb4-35"><a href="library.html#cb4-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">snthresh =</span> <span class="dv">10</span>,</span>
<span id="cb4-36"><a href="library.html#cb4-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prefilter =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">30000</span>),</span>
<span id="cb4-37"><a href="library.html#cb4-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mzCenterFun =</span> <span class="st">&quot;wMean&quot;</span>,</span>
<span id="cb4-38"><a href="library.html#cb4-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">integrate =</span> 1L,</span>
<span id="cb4-39"><a href="library.html#cb4-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mzdiff =</span> <span class="sc">-</span><span class="fl">0.001</span>,</span>
<span id="cb4-40"><a href="library.html#cb4-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fitgauss =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-41"><a href="library.html#cb4-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">noise =</span> <span class="dv">30000</span>,</span>
<span id="cb4-42"><a href="library.html#cb4-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verboseColumns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-43"><a href="library.html#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="library.html#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="library.html#cb4-45" aria-hidden="true" tabindex="-1"></a>xs1 <span class="ot">&lt;-</span> <span class="fu">findChromPeaks</span>(mzXMLfiles, <span class="at">param =</span> cwp)</span>
<span id="cb4-46"><a href="library.html#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="library.html#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co"># use model peak to evaluate process</span></span>
<span id="cb4-48"><a href="library.html#cb4-48" aria-hidden="true" tabindex="-1"></a>rtr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1440</span>, <span class="dv">1460</span>)</span>
<span id="cb4-49"><a href="library.html#cb4-49" aria-hidden="true" tabindex="-1"></a>mzr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">340.238</span>, <span class="fl">340.242</span>)</span>
<span id="cb4-50"><a href="library.html#cb4-50" aria-hidden="true" tabindex="-1"></a>chr_raw <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(mzXMLfiles, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb4-51"><a href="library.html#cb4-51" aria-hidden="true" tabindex="-1"></a>chr_mzr <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs1, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb4-52"><a href="library.html#cb4-52" aria-hidden="true" tabindex="-1"></a>group_colors <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Set1&quot;</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="st">&quot;60&quot;</span>)</span>
<span id="cb4-53"><a href="library.html#cb4-53" aria-hidden="true" tabindex="-1"></a>sample_colors <span class="ot">&lt;-</span> group_colors[xs1<span class="sc">$</span>sample_group]</span>
<span id="cb4-54"><a href="library.html#cb4-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-55"><a href="library.html#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="library.html#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co">#----Group features 1----#</span></span>
<span id="cb4-57"><a href="library.html#cb4-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-58"><a href="library.html#cb4-58" aria-hidden="true" tabindex="-1"></a>pdp <span class="ot">&lt;-</span> <span class="fu">PeakDensityParam</span>(</span>
<span id="cb4-59"><a href="library.html#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleGroups =</span> pd<span class="sc">$</span>sample_group,</span>
<span id="cb4-60"><a href="library.html#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> <span class="dv">10</span>,</span>
<span id="cb4-61"><a href="library.html#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">minFraction =</span> <span class="dv">0</span>,</span>
<span id="cb4-62"><a href="library.html#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">minSamples =</span> <span class="dv">1</span>,</span>
<span id="cb4-63"><a href="library.html#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">binSize =</span> <span class="fl">0.002</span>,</span>
<span id="cb4-64"><a href="library.html#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxFeatures =</span> <span class="dv">1000</span>)</span>
<span id="cb4-65"><a href="library.html#cb4-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-66"><a href="library.html#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="library.html#cb4-67" aria-hidden="true" tabindex="-1"></a>xs2 <span class="ot">&lt;-</span> <span class="fu">groupChromPeaks</span>(xs1, <span class="at">param =</span> pdp)</span>
<span id="cb4-68"><a href="library.html#cb4-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-69"><a href="library.html#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="library.html#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plotChromPeakDensity</span>(chr_mzr, <span class="at">col =</span> sample_colors, <span class="at">param =</span> pdp)</span>
<span id="cb4-71"><a href="library.html#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="library.html#cb4-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-73"><a href="library.html#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="co">#----retention time correction----#</span></span>
<span id="cb4-74"><a href="library.html#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="library.html#cb4-75" aria-hidden="true" tabindex="-1"></a>obip <span class="ot">&lt;-</span> <span class="fu">ObiwarpParam</span>(<span class="at">binSize =</span> <span class="fl">0.05</span>,  <span class="co"># need to check optimal binSize</span></span>
<span id="cb4-76"><a href="library.html#cb4-76" aria-hidden="true" tabindex="-1"></a>                     <span class="at">centerSample =</span> <span class="fu">integer</span>(),</span>
<span id="cb4-77"><a href="library.html#cb4-77" aria-hidden="true" tabindex="-1"></a>                     <span class="at">response =</span> 1L,</span>
<span id="cb4-78"><a href="library.html#cb4-78" aria-hidden="true" tabindex="-1"></a>                     <span class="at">distFun =</span> <span class="st">&quot;cor_opt&quot;</span>,</span>
<span id="cb4-79"><a href="library.html#cb4-79" aria-hidden="true" tabindex="-1"></a>                     <span class="at">gapInit =</span> <span class="fu">numeric</span>(),</span>
<span id="cb4-80"><a href="library.html#cb4-80" aria-hidden="true" tabindex="-1"></a>                     <span class="at">gapExtend =</span> <span class="fu">numeric</span>(),</span>
<span id="cb4-81"><a href="library.html#cb4-81" aria-hidden="true" tabindex="-1"></a>                     <span class="at">factorDiag =</span> <span class="dv">2</span>,</span>
<span id="cb4-82"><a href="library.html#cb4-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">factorGap =</span> <span class="dv">1</span>,</span>
<span id="cb4-83"><a href="library.html#cb4-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">localAlignment =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-84"><a href="library.html#cb4-84" aria-hidden="true" tabindex="-1"></a>                     <span class="at">initPenalty =</span> <span class="dv">0</span>,</span>
<span id="cb4-85"><a href="library.html#cb4-85" aria-hidden="true" tabindex="-1"></a>                     <span class="at">subset =</span> <span class="fu">integer</span>(),</span>
<span id="cb4-86"><a href="library.html#cb4-86" aria-hidden="true" tabindex="-1"></a>                     <span class="at">subsetAdjust =</span> <span class="fu">c</span>(<span class="st">&quot;average&quot;</span>, <span class="st">&quot;previous&quot;</span>))</span>
<span id="cb4-87"><a href="library.html#cb4-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-88"><a href="library.html#cb4-88" aria-hidden="true" tabindex="-1"></a>xs3 <span class="ot">&lt;-</span> <span class="fu">adjustRtime</span>(xs2, <span class="at">param =</span> obip)</span>
<span id="cb4-89"><a href="library.html#cb4-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-90"><a href="library.html#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the base peak chromatograms</span></span>
<span id="cb4-91"><a href="library.html#cb4-91" aria-hidden="true" tabindex="-1"></a>bpis_adj <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs3, <span class="at">aggregationFun =</span> <span class="st">&quot;max&quot;</span>, <span class="at">include =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb4-92"><a href="library.html#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.2</span>, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb4-93"><a href="library.html#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bpis_adj)</span>
<span id="cb4-94"><a href="library.html#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot also the difference of adjusted to raw retention time.</span></span>
<span id="cb4-95"><a href="library.html#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="fu">plotAdjustedRtime</span>(xs3)</span>
<span id="cb4-96"><a href="library.html#cb4-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-97"><a href="library.html#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb4-98"><a href="library.html#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the raw data</span></span>
<span id="cb4-99"><a href="library.html#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chr_raw)</span>
<span id="cb4-100"><a href="library.html#cb4-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-101"><a href="library.html#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract the chromatogram from the adjusted object</span></span>
<span id="cb4-102"><a href="library.html#cb4-102" aria-hidden="true" tabindex="-1"></a>chr_adj <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs3, <span class="at">rt =</span> rtr, <span class="at">mz =</span> mzr)</span>
<span id="cb4-103"><a href="library.html#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chr_adj, <span class="at">peakType =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb4-104"><a href="library.html#cb4-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-105"><a href="library.html#cb4-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-106"><a href="library.html#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="library.html#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="co">#----Group features 2----#</span></span>
<span id="cb4-108"><a href="library.html#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="co"># After retention time correction, the rt values are modified and additional grouping is needed.</span></span>
<span id="cb4-109"><a href="library.html#cb4-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-110"><a href="library.html#cb4-110" aria-hidden="true" tabindex="-1"></a>pdp2 <span class="ot">&lt;-</span> <span class="fu">PeakDensityParam</span>(</span>
<span id="cb4-111"><a href="library.html#cb4-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleGroups =</span> pd<span class="sc">$</span>sample_group,</span>
<span id="cb4-112"><a href="library.html#cb4-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> <span class="dv">5</span>,</span>
<span id="cb4-113"><a href="library.html#cb4-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">minFraction =</span> <span class="dv">0</span>,</span>
<span id="cb4-114"><a href="library.html#cb4-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">minSamples =</span> <span class="dv">1</span>,</span>
<span id="cb4-115"><a href="library.html#cb4-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">binSize =</span> <span class="fl">0.2</span>,</span>
<span id="cb4-116"><a href="library.html#cb4-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxFeatures =</span> <span class="dv">1000</span>)</span>
<span id="cb4-117"><a href="library.html#cb4-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-118"><a href="library.html#cb4-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-119"><a href="library.html#cb4-119" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">groupChromPeaks</span>(xs3, <span class="at">param =</span> pdp2)</span>
<span id="cb4-120"><a href="library.html#cb4-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-121"><a href="library.html#cb4-121" aria-hidden="true" tabindex="-1"></a>xs4_chrom <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs4, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb4-122"><a href="library.html#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="fu">plotChromPeakDensity</span>(xs4_chrom, <span class="at">col =</span> sample_colors, <span class="at">param =</span> pdp2)</span>
<span id="cb4-123"><a href="library.html#cb4-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-124"><a href="library.html#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="co"># iteratively decrease the binSize</span></span>
<span id="cb4-125"><a href="library.html#cb4-125" aria-hidden="true" tabindex="-1"></a>pdp3 <span class="ot">&lt;-</span> <span class="fu">PeakDensityParam</span>(</span>
<span id="cb4-126"><a href="library.html#cb4-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleGroups =</span> pd<span class="sc">$</span>sample_group,</span>
<span id="cb4-127"><a href="library.html#cb4-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> <span class="dv">2</span>,</span>
<span id="cb4-128"><a href="library.html#cb4-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">minFraction =</span> <span class="dv">0</span>,</span>
<span id="cb4-129"><a href="library.html#cb4-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">minSamples =</span> <span class="dv">1</span>,</span>
<span id="cb4-130"><a href="library.html#cb4-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">binSize =</span> <span class="fl">0.002</span>,</span>
<span id="cb4-131"><a href="library.html#cb4-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxFeatures =</span> <span class="dv">1000</span>)</span>
<span id="cb4-132"><a href="library.html#cb4-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-133"><a href="library.html#cb4-133" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">groupChromPeaks</span>(xs4, <span class="at">param =</span> pdp3)</span>
<span id="cb4-134"><a href="library.html#cb4-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-135"><a href="library.html#cb4-135" aria-hidden="true" tabindex="-1"></a>xs4_chrom <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs4, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb4-136"><a href="library.html#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="fu">plotChromPeakDensity</span>(xs4_chrom, <span class="at">col =</span> sample_colors, <span class="at">param =</span> pdp3)</span>
<span id="cb4-137"><a href="library.html#cb4-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-138"><a href="library.html#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="co">#----Fill missing features----#</span></span>
<span id="cb4-139"><a href="library.html#cb4-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-140"><a href="library.html#cb4-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-141"><a href="library.html#cb4-141" aria-hidden="true" tabindex="-1"></a>xs5 <span class="ot">&lt;-</span> <span class="fu">fillChromPeaks</span>(xs4)</span>
<span id="cb4-142"><a href="library.html#cb4-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-143"><a href="library.html#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="do">## Check missing values before filling in peaks</span></span>
<span id="cb4-144"><a href="library.html#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">featureValues</span>(xs5, <span class="at">filled =</span> <span class="cn">FALSE</span>), <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb4-145"><a href="library.html#cb4-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="cf">function</span>(z) <span class="fu">sum</span>(<span class="fu">is.na</span>(z)))</span>
<span id="cb4-146"><a href="library.html#cb4-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-147"><a href="library.html#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="do">## Missing values after filling in peaks</span></span>
<span id="cb4-148"><a href="library.html#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">featureValues</span>(xs5), <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb4-149"><a href="library.html#cb4-149" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="cf">function</span>(z) <span class="fu">sum</span>(<span class="fu">is.na</span>(z)))</span>
<span id="cb4-150"><a href="library.html#cb4-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-151"><a href="library.html#cb4-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-152"><a href="library.html#cb4-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-153"><a href="library.html#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="co">#---- QC ----#</span></span>
<span id="cb4-154"><a href="library.html#cb4-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-155"><a href="library.html#cb4-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract chromatograms of 4 features</span></span>
<span id="cb4-156"><a href="library.html#cb4-156" aria-hidden="true" tabindex="-1"></a>feature_chroms <span class="ot">&lt;-</span> <span class="fu">featureChromatograms</span>(xs5, <span class="at">features =</span> <span class="dv">10000</span><span class="sc">:</span><span class="dv">10004</span>)</span>
<span id="cb4-157"><a href="library.html#cb4-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-158"><a href="library.html#cb4-158" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(feature_chroms)</span>
<span id="cb4-159"><a href="library.html#cb4-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-160"><a href="library.html#cb4-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-161"><a href="library.html#cb4-161" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">featureValues</span>(xs5, <span class="at">value=</span><span class="st">&quot;into&quot;</span>) <span class="sc">+</span><span class="dv">1</span>, </span>
<span id="cb4-162"><a href="library.html#cb4-162" aria-hidden="true" tabindex="-1"></a>        <span class="co">#col=as.numeric(sampclass(mtbls2Set))+1, </span></span>
<span id="cb4-163"><a href="library.html#cb4-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">log=</span><span class="st">&quot;y&quot;</span>, <span class="at">las=</span><span class="dv">2</span>)</span>
<span id="cb4-164"><a href="library.html#cb4-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-165"><a href="library.html#cb4-165" aria-hidden="true" tabindex="-1"></a>sdThresh <span class="ot">&lt;-</span> <span class="fl">4.0</span> <span class="do">## Filter low-standard deviation rows for plot</span></span>
<span id="cb4-166"><a href="library.html#cb4-166" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">featureValues</span>(xs5))<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-167"><a href="library.html#cb4-167" aria-hidden="true" tabindex="-1"></a>pca.result <span class="ot">&lt;-</span> <span class="fu">pca</span>(data, <span class="at">nPcs=</span><span class="dv">3</span>)</span>
<span id="cb4-168"><a href="library.html#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPcs</span>(pca.result, <span class="at">type=</span><span class="st">&quot;loadings&quot;</span>, </span>
<span id="cb4-169"><a href="library.html#cb4-169" aria-hidden="true" tabindex="-1"></a>        <span class="co">#col=as.numeric(sampclass(mtbls2Set))+1</span></span>
<span id="cb4-170"><a href="library.html#cb4-170" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb4-171"><a href="library.html#cb4-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-172"><a href="library.html#cb4-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-173"><a href="library.html#cb4-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-174"><a href="library.html#cb4-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-175"><a href="library.html#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="co"># It is possible to use the retention time correction and grouping step in an iterative way if needed. </span></span>
<span id="cb4-176"><a href="library.html#cb4-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Once you perform your last adjustRtime step and thus your last grouping step, you will obtain your final peak list (i.e. final list of ions)</span></span>
<span id="cb4-177"><a href="library.html#cb4-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-178"><a href="library.html#cb4-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-179"><a href="library.html#cb4-179" aria-hidden="true" tabindex="-1"></a><span class="co">#----Annotation using CAMERA----#</span></span>
<span id="cb4-180"><a href="library.html#cb4-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-181"><a href="library.html#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Since CAMERA has not yet been ported to XCMSnExp,we need to convert to xcmsSet. </span></span>
<span id="cb4-182"><a href="library.html#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the conversion only makes sense for somple XCMSnSets, </span></span>
<span id="cb4-183"><a href="library.html#cb4-183" aria-hidden="true" tabindex="-1"></a><span class="co"># without e.g. MS level filtering (where CAMERA would then extract the wrong peaks)</span></span>
<span id="cb4-184"><a href="library.html#cb4-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-185"><a href="library.html#cb4-185" aria-hidden="true" tabindex="-1"></a>xs6 <span class="ot">&lt;-</span> <span class="fu">as</span>(xs5, <span class="st">&quot;xcmsSet&quot;</span>)</span>
<span id="cb4-186"><a href="library.html#cb4-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-187"><a href="library.html#cb4-187" aria-hidden="true" tabindex="-1"></a>xs6 <span class="ot">&lt;-</span> <span class="fu">xsAnnotate</span>(<span class="at">xs =</span> xs6, <span class="at">sample=</span><span class="cn">NA</span>, <span class="at">polarity =</span> <span class="st">&quot;positive&quot;</span>)</span>
<span id="cb4-188"><a href="library.html#cb4-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-189"><a href="library.html#cb4-189" aria-hidden="true" tabindex="-1"></a>xs7 <span class="ot">&lt;-</span> <span class="fu">groupFWHM</span>(xs6, <span class="at">sigma =</span> <span class="dv">6</span> , <span class="at">perfwhm =</span> <span class="dv">2</span>, <span class="at">intval =</span> <span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb4-190"><a href="library.html#cb4-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-191"><a href="library.html#cb4-191" aria-hidden="true" tabindex="-1"></a>xs8 <span class="ot">&lt;-</span> <span class="fu">groupCorr</span>(xs7, <span class="at">cor_eic_th =</span> <span class="fl">0.8</span>, <span class="at">calcCaS =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-192"><a href="library.html#cb4-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-193"><a href="library.html#cb4-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-194"><a href="library.html#cb4-194" aria-hidden="true" tabindex="-1"></a><span class="co">#how many fragments need to be in a group for it to be included in the results. 5 - trace compounds; 20 - mostly high quality spectra</span></span>
<span id="cb4-195"><a href="library.html#cb4-195" aria-hidden="true" tabindex="-1"></a>min.clustersize <span class="ot">&lt;-</span> <span class="dv">20</span> </span>
<span id="cb4-196"><a href="library.html#cb4-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-197"><a href="library.html#cb4-197" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;into&quot;</span>)</span>
<span id="cb4-198"><a href="library.html#cb4-198" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(peaktable, <span class="at">file =</span> <span class="st">&quot;test_peaktable.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with all m/z features sorted into &quot;compounds&quot;</span></span>
<span id="cb4-199"><a href="library.html#cb4-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-200"><a href="library.html#cb4-200" aria-hidden="true" tabindex="-1"></a><span class="co">#the following script identifies all &quot;compounds&quot; considered too small according to min.clustersize</span></span>
<span id="cb4-201"><a href="library.html#cb4-201" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb4-202"><a href="library.html#cb4-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-203"><a href="library.html#cb4-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Replaces NA in intensities with zero</span></span>
<span id="cb4-204"><a href="library.html#cb4-204" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> peaktable <span class="sc">%&gt;%</span></span>
<span id="cb4-205"><a href="library.html#cb4-205" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;X&quot;</span>), <span class="sc">~</span>tidyr<span class="sc">::</span><span class="fu">replace_na</span>(., <span class="dv">0</span>)))</span>
<span id="cb4-206"><a href="library.html#cb4-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-207"><a href="library.html#cb4-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-208"><a href="library.html#cb4-208" aria-hidden="true" tabindex="-1"></a>pcgroups <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(peaktable<span class="sc">$</span>pcgroup)))</span>
<span id="cb4-209"><a href="library.html#cb4-209" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-210"><a href="library.html#cb4-210" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-211"><a href="library.html#cb4-211" aria-hidden="true" tabindex="-1"></a>small.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-212"><a href="library.html#cb4-212" aria-hidden="true" tabindex="-1"></a>big.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-213"><a href="library.html#cb4-213" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb4-214"><a href="library.html#cb4-214" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="fu">seq_along</span>(pcgroups)) {</span>
<span id="cb4-215"><a href="library.html#cb4-215" aria-hidden="true" tabindex="-1"></a>  clustersize <span class="ot">&lt;-</span> <span class="fu">length</span>(peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,<span class="fu">ncol</span>(peaktable)])</span>
<span id="cb4-216"><a href="library.html#cb4-216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(clustersize <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(min.clustersize))</span>
<span id="cb4-217"><a href="library.html#cb4-217" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-218"><a href="library.html#cb4-218" aria-hidden="true" tabindex="-1"></a>    small.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(small.clusters, x)</span>
<span id="cb4-219"><a href="library.html#cb4-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-220"><a href="library.html#cb4-220" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb4-221"><a href="library.html#cb4-221" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-222"><a href="library.html#cb4-222" aria-hidden="true" tabindex="-1"></a>    big.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(big.clusters, x)</span>
<span id="cb4-223"><a href="library.html#cb4-223" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,]</span>
<span id="cb4-224"><a href="library.html#cb4-224" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">3</span><span class="sc">-</span>(<span class="fu">length</span>(mzXMLfiles))))]</span>
<span id="cb4-225"><a href="library.html#cb4-225" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">2</span>))]</span>
<span id="cb4-226"><a href="library.html#cb4-226" aria-hidden="true" tabindex="-1"></a>    decider <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb4-227"><a href="library.html#cb4-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-228"><a href="library.html#cb4-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(gruppe1))</span>
<span id="cb4-229"><a href="library.html#cb4-229" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb4-230"><a href="library.html#cb4-230" aria-hidden="true" tabindex="-1"></a>      decider <span class="ot">&lt;-</span> <span class="fu">c</span>(decider, <span class="fu">sum</span>(gruppe1[, i]))</span>
<span id="cb4-231"><a href="library.html#cb4-231" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-232"><a href="library.html#cb4-232" aria-hidden="true" tabindex="-1"></a>    highest <span class="ot">&lt;-</span> <span class="fu">which</span>(decider<span class="sc">==</span><span class="fu">max</span>(decider), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-233"><a href="library.html#cb4-233" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(gruppe1[, <span class="dv">1</span>], gruppe1[, highest[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb4-234"><a href="library.html#cb4-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(gruppe1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mz&quot;</span>, <span class="st">&quot;int&quot;</span>)</span>
<span id="cb4-235"><a href="library.html#cb4-235" aria-hidden="true" tabindex="-1"></a>    lspectra[[n]] <span class="ot">&lt;-</span> gruppe1</span>
<span id="cb4-236"><a href="library.html#cb4-236" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb4-237"><a href="library.html#cb4-237" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-238"><a href="library.html#cb4-238" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-239"><a href="library.html#cb4-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-240"><a href="library.html#cb4-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-241"><a href="library.html#cb4-241" aria-hidden="true" tabindex="-1"></a><span class="co"># remove peaks with zero intensities</span></span>
<span id="cb4-242"><a href="library.html#cb4-242" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lspectra, <span class="cf">function</span>(x) {x[x<span class="sc">$</span>int <span class="sc">!=</span> <span class="dv">0</span>,]})</span>
<span id="cb4-243"><a href="library.html#cb4-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-244"><a href="library.html#cb4-244" aria-hidden="true" tabindex="-1"></a>reduced.peaktable <span class="ot">&lt;-</span> <span class="fu">getReducedPeaklist</span>(xs8, <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">intval =</span> <span class="st">&quot;into&quot;</span>, <span class="at">default.adduct.info =</span> <span class="st">&quot;maxint&quot;</span>, <span class="at">mzrt.range =</span> <span class="cn">FALSE</span>, <span class="at">npeaks.sum =</span> <span class="cn">FALSE</span>, <span class="at">cleanup =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-245"><a href="library.html#cb4-245" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(small.clusters)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb4-246"><a href="library.html#cb4-246" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(z <span class="cf">in</span> small.clusters)</span>
<span id="cb4-247"><a href="library.html#cb4-247" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb4-248"><a href="library.html#cb4-248" aria-hidden="true" tabindex="-1"></a>    reduced.peaktable <span class="ot">&lt;-</span> reduced.peaktable[<span class="sc">-</span>(<span class="fu">which</span>(reduced.peaktable[, <span class="fu">ncol</span>(reduced.peaktable)]<span class="sc">==</span>z)), ]</span>
<span id="cb4-249"><a href="library.html#cb4-249" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-250"><a href="library.html#cb4-250" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-251"><a href="library.html#cb4-251" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(reduced.peaktable, <span class="at">file =</span> <span class="st">&quot;test_peaktable.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with only &quot;compounds&quot; instead of m/z features</span></span>
<span id="cb4-252"><a href="library.html#cb4-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-253"><a href="library.html#cb4-253" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="fu">paste</span>(<span class="st">&quot;Unknown&quot;</span>, big.clusters, <span class="st">&quot;RT =&quot;</span>,<span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>) ), <span class="at">Class =</span> <span class="st">&quot;Unknown&quot;</span>, <span class="at">RT =</span> <span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>),  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-254"><a href="library.html#cb4-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-255"><a href="library.html#cb4-255" aria-hidden="true" tabindex="-1"></a><span class="do">####KOVATS#####</span></span>
<span id="cb4-256"><a href="library.html#cb4-256" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding Kovats retention index to the extra obejct to write to msp</span></span>
<span id="cb4-257"><a href="library.html#cb4-257" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rt =</span> extra<span class="sc">$</span>RT)</span>
<span id="cb4-258"><a href="library.html#cb4-258" aria-hidden="true" tabindex="-1"></a>alkaneSeries <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Num =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">25</span>),</span>
<span id="cb4-259"><a href="library.html#cb4-259" aria-hidden="true" tabindex="-1"></a>                           <span class="at">rt =</span> <span class="fu">c</span>(<span class="fl">4.90</span>, <span class="fl">8.00</span>, <span class="fl">11.13</span>, <span class="fl">14.05</span>, <span class="fl">16.70</span>, <span class="fl">19.37</span>, <span class="fl">22.45</span>, <span class="fl">25.77</span>))</span>
<span id="cb4-260"><a href="library.html#cb4-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-261"><a href="library.html#cb4-261" aria-hidden="true" tabindex="-1"></a>RI <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="fu">nrow</span>(data))</span>
<span id="cb4-262"><a href="library.html#cb4-262" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data))) {</span>
<span id="cb4-263"><a href="library.html#cb4-263" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb4-264"><a href="library.html#cb4-264" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">1</span>],</span>
<span id="cb4-265"><a href="library.html#cb4-265" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb4-266"><a href="library.html#cb4-266" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb4-267"><a href="library.html#cb4-267" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb4-268"><a href="library.html#cb4-268" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb4-269"><a href="library.html#cb4-269" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb4-270"><a href="library.html#cb4-270" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>]</span>
<span id="cb4-271"><a href="library.html#cb4-271" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-272"><a href="library.html#cb4-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-273"><a href="library.html#cb4-273" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb4-274"><a href="library.html#cb4-274" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb4-275"><a href="library.html#cb4-275" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb4-276"><a href="library.html#cb4-276" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb4-277"><a href="library.html#cb4-277" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb4-278"><a href="library.html#cb4-278" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb4-279"><a href="library.html#cb4-279" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>],</span>
<span id="cb4-280"><a href="library.html#cb4-280" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">8</span>]</span>
<span id="cb4-281"><a href="library.html#cb4-281" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-282"><a href="library.html#cb4-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-283"><a href="library.html#cb4-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-284"><a href="library.html#cb4-284" aria-hidden="true" tabindex="-1"></a>RI[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>n <span class="sc">+</span> <span class="dv">100</span><span class="sc">*</span>(m<span class="sc">-</span>n) <span class="sc">*</span> (data<span class="sc">$</span>rt[i] <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt)<span class="sc">/</span>(alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> m,]<span class="sc">$</span>rt <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt), <span class="dv">0</span>)</span>
<span id="cb4-285"><a href="library.html#cb4-285" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-286"><a href="library.html#cb4-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-287"><a href="library.html#cb4-287" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">cbind</span>(extra, RI)</span>
<span id="cb4-288"><a href="library.html#cb4-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-289"><a href="library.html#cb4-289" aria-hidden="true" tabindex="-1"></a><span class="do">######</span><span class="re">END</span><span class="do"> KOVATS######</span></span>
<span id="cb4-290"><a href="library.html#cb4-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-291"><a href="library.html#cb4-291" aria-hidden="true" tabindex="-1"></a><span class="co"># create the msp object with spectra and all meta information in the extra object (NAME, RETENTIONTIME, RETENTIONINDEX)</span></span>
<span id="cb4-292"><a href="library.html#cb4-292" aria-hidden="true" tabindex="-1"></a>export.msp <span class="ot">&lt;-</span> <span class="fu">construct.msp</span>(lspectra, extra)</span>
<span id="cb4-293"><a href="library.html#cb4-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-294"><a href="library.html#cb4-294" aria-hidden="true" tabindex="-1"></a><span class="fu">write.msp</span>(export.msp, <span class="at">file =</span> <span class="st">&quot;test_spectra.msp&quot;</span>) <span class="co">#This creates a NIST MS Search compatible .msp file with all compound pseudospectra</span></span></code></pre></div>
</div>
<div id="lc-hrms-using-waters-mse-dia-workflow" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> <strong>LC-HRMS using Waters MSe DIA workflow</strong></h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="library.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xcms)</span></code></pre></div>
<pre><code>## Loading required package: Biobase</code></pre>
<pre><code>## Loading required package: BiocGenerics</code></pre>
<pre><code>## Loading required package: parallel</code></pre>
<pre><code>## 
## Attaching package: &#39;BiocGenerics&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:parallel&#39;:
## 
##     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,
##     clusterExport, clusterMap, parApply, parCapply, parLapply,
##     parLapplyLB, parRapply, parSapply, parSapplyLB</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     combine, intersect, setdiff, union</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     IQR, mad, sd, var, xtabs</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     anyDuplicated, append, as.data.frame, basename, cbind, colnames,
##     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,
##     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,
##     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,
##     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,
##     union, unique, unsplit, which.max, which.min</code></pre>
<pre><code>## Welcome to Bioconductor
## 
##     Vignettes contain introductory material; view with
##     &#39;browseVignettes()&#39;. To cite Bioconductor, see
##     &#39;citation(&quot;Biobase&quot;)&#39;, and for packages &#39;citation(&quot;pkgname&quot;)&#39;.</code></pre>
<pre><code>## Loading required package: BiocParallel</code></pre>
<pre><code>## Loading required package: MSnbase</code></pre>
<pre><code>## Loading required package: mzR</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre><code>## Warning in fun(libname, pkgname): mzR has been built against a different Rcpp version (1.0.5)
## than is installed on your system (1.0.6). This might lead to errors
## when loading mzR. If you encounter such issues, please send a report,
## including the output of sessionInfo() to the Bioc support forum at 
## https://support.bioconductor.org/. For details see also
## https://github.com/sneumann/mzR/wiki/mzR-Rcpp-compiler-linker-issue.</code></pre>
<pre><code>## Loading required package: S4Vectors</code></pre>
<pre><code>## Loading required package: stats4</code></pre>
<pre><code>## 
## Attaching package: &#39;S4Vectors&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plotly&#39;:
## 
##     rename</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     first, rename</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     expand</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     expand.grid</code></pre>
<pre><code>## Loading required package: ProtGenerics</code></pre>
<pre><code>## 
## Attaching package: &#39;ProtGenerics&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     smooth</code></pre>
<pre><code>## 
## This is MSnbase version 2.16.1 
##   Visit https://lgatto.github.io/MSnbase/ to get started.</code></pre>
<pre><code>## 
## Attaching package: &#39;MSnbase&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     trimws</code></pre>
<pre><code>## 
## This is xcms version 3.12.0</code></pre>
<pre><code>## 
## Attaching package: &#39;xcms&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:plotly&#39;:
## 
##     groups</code></pre>
<pre><code>## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     collect, groups</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     sigma</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="library.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="library.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RAMClustR)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;RAMClustR&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:ggplot2&#39;:
## 
##     annotate</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="molecular-networks.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown/edit/master/inst/examples/10-Example_Dust.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SSANTA.pdf", "SSANTA.epub", "SSANTA.mobi"],
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
