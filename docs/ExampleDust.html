<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>11 Example workflow: indoor dust | Handbook of comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS</title>
  <meta name="description" content="SSANTA." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="11 Example workflow: indoor dust | Handbook of comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://www.oru.se/personal/thanh_wang" />
  <meta property="og:image" content="https://www.oru.se/personal/thanh_wang/images/ORU.png" />
  <meta property="og:description" content="SSANTA." />
  <meta name="github-repo" content="WBS-TW/WBS-TW.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="11 Example workflow: indoor dust | Handbook of comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS" />
  
  <meta name="twitter:description" content="SSANTA." />
  <meta name="twitter:image" content="https://www.oru.se/personal/thanh_wang/images/ORU.png" />

<meta name="author" content="Thanh Wang,   MTM Research Centre, Örebro University" />


<meta name="date" content="2022-03-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="PostProcessing.html"/>
<link rel="next" href="ExamplePFAS.html"/>
<script src="libs/header-attrs-2.12/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.8/grViz.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.21/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SSA/NTA</a></li>

<li class="divider"></li>
<li><a href="index.html#preface">Preface<span></span></a></li>
<li class="chapter" data-level="1" data-path="Intro.html"><a href="Intro.html"><i class="fa fa-check"></i><b>1</b> <strong>Introduction and concepts</strong><span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="Intro.html"><a href="Intro.html#terminologies"><i class="fa fa-check"></i><b>1.1</b> Terminologies<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="ExpDesign.html"><a href="ExpDesign.html"><i class="fa fa-check"></i><b>2</b> <strong>Experimental design</strong><span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="ExpDesign.html"><a href="ExpDesign.html#hypothesis"><i class="fa fa-check"></i><b>2.1</b> Hypothesis<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="ExpDesign.html"><a href="ExpDesign.html#experimental-design"><i class="fa fa-check"></i><b>2.2</b> Experimental design<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="ExpDesign.html"><a href="ExpDesign.html#qaqc-measures"><i class="fa fa-check"></i><b>2.3</b> QA/QC measures<span></span></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="ExpDesign.html"><a href="ExpDesign.html#recovery-extraction-efficieny"><i class="fa fa-check"></i><b>2.3.1</b> Recovery (Extraction efficieny)<span></span></a></li>
<li class="chapter" data-level="2.3.2" data-path="ExpDesign.html"><a href="ExpDesign.html#matrix-effects"><i class="fa fa-check"></i><b>2.3.2</b> Matrix effects<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="ExpDesign.html"><a href="ExpDesign.html#data-directory-structure"><i class="fa fa-check"></i><b>2.4</b> Data directory structure<span></span></a></li>
<li class="chapter" data-level="2.5" data-path="ExpDesign.html"><a href="ExpDesign.html#sampling-design-and-collection"><i class="fa fa-check"></i><b>2.5</b> Sampling design and collection<span></span></a></li>
<li class="chapter" data-level="2.6" data-path="ExpDesign.html"><a href="ExpDesign.html#collection-of-metadata"><i class="fa fa-check"></i><b>2.6</b> Collection of metadata<span></span></a></li>
<li class="chapter" data-level="2.7" data-path="ExpDesign.html"><a href="ExpDesign.html#chemical-analysis"><i class="fa fa-check"></i><b>2.7</b> Chemical analysis<span></span></a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="ExpDesign.html"><a href="ExpDesign.html#data-recording-modes"><i class="fa fa-check"></i><b>2.7.1</b> Data recording modes<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="ExpDesign.html"><a href="ExpDesign.html#data-analysis"><i class="fa fa-check"></i><b>2.8</b> Data analysis<span></span></a></li>
<li class="chapter" data-level="2.9" data-path="ExpDesign.html"><a href="ExpDesign.html#workflow-examples"><i class="fa fa-check"></i><b>2.9</b> Workflow examples<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="SamplePretreatment.html"><a href="SamplePretreatment.html"><i class="fa fa-check"></i><b>3</b> <strong>Sample pretreatment for nontarget and suspect screening</strong><span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="SamplePretreatment.html"><a href="SamplePretreatment.html#accelerated-solvent-extraction-ase"><i class="fa fa-check"></i><b>3.1</b> Accelerated solvent extraction (ASE)<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="SamplePretreatment.html"><a href="SamplePretreatment.html#ultrasonic-extraction"><i class="fa fa-check"></i><b>3.2</b> Ultrasonic extraction<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="MSPreprocess.html"><a href="MSPreprocess.html"><i class="fa fa-check"></i><b>4</b> <strong>Pre-processing HRMS data</strong><span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="MSPreprocess.html"><a href="MSPreprocess.html#raw-data-conversion"><i class="fa fa-check"></i><b>4.1</b> Raw data conversion<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="MSPreprocess.html"><a href="MSPreprocess.html#peak-picking"><i class="fa fa-check"></i><b>4.2</b> Peak picking<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="MSPreprocess.html"><a href="MSPreprocess.html#open-tools-for-preprocessing"><i class="fa fa-check"></i><b>4.3</b> Open tools for preprocessing<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="MSPreprocess.html"><a href="MSPreprocess.html#openms-and-toppview"><i class="fa fa-check"></i><b>4.4</b> OpenMS and Toppview<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="MSPreprocess.html"><a href="MSPreprocess.html#msnbase-and-xcms"><i class="fa fa-check"></i><b>4.5</b> MsnBase and XCMS<span></span></a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="MSPreprocess.html"><a href="MSPreprocess.html#xcms"><i class="fa fa-check"></i><b>4.5.1</b> XCMS<span></span></a></li>
<li class="chapter" data-level="4.5.2" data-path="MSPreprocess.html"><a href="MSPreprocess.html#camera"><i class="fa fa-check"></i><b>4.5.2</b> CAMERA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="MSPreprocess.html"><a href="MSPreprocess.html#patroon"><i class="fa fa-check"></i><b>4.6</b> PatRoon<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="MSPreprocess.html"><a href="MSPreprocess.html#ms-dial"><i class="fa fa-check"></i><b>4.7</b> MS-DIAL<span></span></a></li>
<li class="chapter" data-level="4.8" data-path="MSPreprocess.html"><a href="MSPreprocess.html#output-formats"><i class="fa fa-check"></i><b>4.8</b> Output formats<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="suspectScreening.html"><a href="suspectScreening.html"><i class="fa fa-check"></i><b>5</b> <strong>Suspect screening</strong><span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="suspectScreening.html"><a href="suspectScreening.html#lib2nist"><i class="fa fa-check"></i><b>5.1</b> LIB2NIST<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="suspectScreening.html"><a href="suspectScreening.html#listing-suspects"><i class="fa fa-check"></i><b>5.2</b> Listing suspects<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="suspectScreening.html"><a href="suspectScreening.html#suspect-scoring"><i class="fa fa-check"></i><b>5.3</b> Suspect scoring<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="MassDefect.html"><a href="MassDefect.html"><i class="fa fa-check"></i><b>6</b> <strong>Mass defect plots</strong><span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="MassDefect.html"><a href="MassDefect.html#mdplotr"><i class="fa fa-check"></i><b>6.1</b> MDPlotR<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="MassDefect.html"><a href="MassDefect.html#findhalo"><i class="fa fa-check"></i><b>6.2</b> findhalo<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="RetentionTime.html"><a href="RetentionTime.html"><i class="fa fa-check"></i><b>7</b> <strong>Retention time index and prediction</strong><span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="RetentionTime.html"><a href="RetentionTime.html#lc"><i class="fa fa-check"></i><b>7.1</b> LC<span></span></a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="RetentionTime.html"><a href="RetentionTime.html#retip---retention-time-prediction-for-metabolomics"><i class="fa fa-check"></i><b>7.1.1</b> Retip - Retention Time prediction for Metabolomics<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="MolecularNetworks.html"><a href="MolecularNetworks.html"><i class="fa fa-check"></i><b>8</b> <strong>Molecular networks</strong><span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="MolecularNetworks.html"><a href="MolecularNetworks.html#metgem"><i class="fa fa-check"></i><b>8.1</b> MetGem<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="MolecularNetworks.html"><a href="MolecularNetworks.html#gc-data"><i class="fa fa-check"></i><b>8.1.1</b> GC data<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="Library.html"><a href="Library.html"><i class="fa fa-check"></i><b>9</b> <strong>Spectral libraries</strong><span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="Library.html"><a href="Library.html#in-silico-fragmentation"><i class="fa fa-check"></i><b>9.1</b> IN SILICO FRAGMENTATION<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="Library.html"><a href="Library.html#metfrag"><i class="fa fa-check"></i><b>9.1.1</b> Metfrag<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="Library.html"><a href="Library.html#sirius-csi-fingerid"><i class="fa fa-check"></i><b>9.1.2</b> Sirius CSI FingerID<span></span></a></li>
<li class="chapter" data-level="9.1.3" data-path="Library.html"><a href="Library.html#cfm-id"><i class="fa fa-check"></i><b>9.1.3</b> CFM-ID<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="Library.html"><a href="Library.html#neims"><i class="fa fa-check"></i><b>9.2</b> NEIMS<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="Library.html"><a href="Library.html#deepei"><i class="fa fa-check"></i><b>9.3</b> DeepEI<span></span></a></li>
<li class="chapter" data-level="9.4" data-path="Library.html"><a href="Library.html#qcxms"><i class="fa fa-check"></i><b>9.4</b> QCxMS<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="Library.html"><a href="Library.html#library-search"><i class="fa fa-check"></i><b>9.5</b> LIBRARY SEARCH<span></span></a></li>
<li class="chapter" data-level="9.6" data-path="Library.html"><a href="Library.html#reading-mgf-files-in-r"><i class="fa fa-check"></i><b>9.6</b> Reading mgf files in R<span></span></a></li>
<li class="chapter" data-level="9.7" data-path="Library.html"><a href="Library.html#lib2nist-1"><i class="fa fa-check"></i><b>9.7</b> LIB2NIST<span></span></a></li>
<li class="chapter" data-level="9.8" data-path="Library.html"><a href="Library.html#mspepsearch"><i class="fa fa-check"></i><b>9.8</b> MSPepSearch<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="PostProcessing.html"><a href="PostProcessing.html"><i class="fa fa-check"></i><b>10</b> <strong>Data post-processing</strong><span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="PostProcessing.html"><a href="PostProcessing.html#hierarchical-clustering"><i class="fa fa-check"></i><b>10.1</b> Hierarchical clustering<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="ExampleDust.html"><a href="ExampleDust.html"><i class="fa fa-check"></i><b>11</b> Example workflow: indoor dust<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="ExampleDust.html"><a href="ExampleDust.html#gc-orbitrap-hrms-workflow"><i class="fa fa-check"></i><b>11.1</b> GC orbitrap HRMS workflow<span></span></a></li>
<li class="chapter" data-level="11.2" data-path="ExampleDust.html"><a href="ExampleDust.html#lc-hrms-using-waters-mse-dia-workflow"><i class="fa fa-check"></i><b>11.2</b> LC-HRMS using Waters MSe DIA workflow<span></span></a></li>
<li class="chapter" data-level="11.3" data-path="ExampleDust.html"><a href="ExampleDust.html#workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2"><i class="fa fa-check"></i><b>11.3</b> Workflow for centroiding of raw file, peak picking and correlation of MS1 and MS2<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="ExampleDust.html"><a href="ExampleDust.html#first-convert-unifi-data-using-msconvert"><i class="fa fa-check"></i><b>11.4</b> First convert unifi data using MSConvert<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="ExampleDust.html"><a href="ExampleDust.html#centroiding-raw-data-from-mzml-using-msnbase"><i class="fa fa-check"></i><b>11.5</b> Centroiding raw data from mzML using MSnbase<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="ExamplePFAS.html"><a href="ExamplePFAS.html"><i class="fa fa-check"></i><b>12</b> Example workflow: PFASs<span></span></a></li>
<li class="chapter" data-level="13" data-path="DataConversion.html"><a href="DataConversion.html"><i class="fa fa-check"></i><b>13</b> Conversion of raw data from HRMS vendor format to open format<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="DataConversion.html"><a href="DataConversion.html#MSConvertGC"><i class="fa fa-check"></i><b>13.1</b> GC orbitrap HRMS: convert .raw data to .mzML using MSconvert<span></span></a></li>
<li class="chapter" data-level="13.2" data-path="DataConversion.html"><a href="DataConversion.html#MSConvertunifi"><i class="fa fa-check"></i><b>13.2</b> LC-HRMS: convert the raw data file from unifi to mzML using MSconvert<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="GClib.html"><a href="GClib.html"><i class="fa fa-check"></i><b>14</b> MTM HRMS Library: GC-HRMS<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="GClib.html"><a href="GClib.html#analyze-the-standards-using-hrms"><i class="fa fa-check"></i><b>14.1</b> Analyze the standards using HRMS<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="GClib.html"><a href="GClib.html#convert-the-raw-data-file-from-gc-hrms-analysis-to-.mzml-using-msconvert-for-unifi-conversion-see-section-refmsconvertgc"><i class="fa fa-check"></i><b>14.2</b> Convert the raw data file from GC-HRMS analysis to .mzML using MSconvert (For unifi conversion, see section @ref(MSConvertGC)<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="GClib.html"><a href="GClib.html#fill-in-the-standard-infosheet"><i class="fa fa-check"></i><b>14.3</b> Fill in the standard infosheet<span></span></a></li>
<li class="chapter" data-level="14.4" data-path="GClib.html"><a href="GClib.html#use-ms-dial-to-perform-spectral-deconvolution-and-generate-spectra-for-each-compound"><i class="fa fa-check"></i><b>14.4</b> Use MS-DIAL to perform spectral deconvolution and generate spectra for each compound<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="mtm-hrms-library-lc-hrms.html"><a href="mtm-hrms-library-lc-hrms.html"><i class="fa fa-check"></i><b>15</b> MTM HRMS Library: LC-HRMS<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="mtm-hrms-library-lc-hrms.html"><a href="mtm-hrms-library-lc-hrms.html#analyze-the-standards-using-hrms-1"><i class="fa fa-check"></i><b>15.1</b> Analyze the standards using HRMS<span></span></a></li>
<li class="chapter" data-level="15.2" data-path="mtm-hrms-library-lc-hrms.html"><a href="mtm-hrms-library-lc-hrms.html#convert-the-raw-data-file-from-lc-hrms-in-unifi-to-mzml-using-msconvert"><i class="fa fa-check"></i><b>15.2</b> Convert the raw data file from LC-HRMS in unifi to mzML using MSconvert<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="mtm-hrms-library-lc-hrms.html"><a href="mtm-hrms-library-lc-hrms.html#fill-in-the-standard-infosheet-1"><i class="fa fa-check"></i><b>15.3</b> Fill in the standard infosheet<span></span></a></li>
<li class="chapter" data-level="15.4" data-path="mtm-hrms-library-lc-hrms.html"><a href="mtm-hrms-library-lc-hrms.html#use-ms-dial-to-perform-spectral-deconvolution-and-generate-spectra-for-each-compound-1"><i class="fa fa-check"></i><b>15.4</b> Use MS-DIAL to perform spectral deconvolution and generate spectra for each compound<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="GCMSDIAL.html"><a href="GCMSDIAL.html"><i class="fa fa-check"></i><b>16</b> GC-HRMS raw data preprocessing with MS-DIAL<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="GCMSDIAL.html"><a href="GCMSDIAL.html#further-explanation-for-some-terminologies-apart-from-the-tutorial-httpsmtbinfo-team.github.iomtbinfo.github.ioms-dialtutorial"><i class="fa fa-check"></i><b>16.1</b> Further explanation for some terminologies apart from the tutorial (<span>https://mtbinfo-team.github.io/mtbinfo.github.io/MS-DIAL/tutorial</span>)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="GCOrbitrapHandbook.html"><a href="GCOrbitrapHandbook.html"><i class="fa fa-check"></i><b>17</b> A handbook on GC Q Exactive orbitrap use<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="GCOrbitrapHandbook.html"><a href="GCOrbitrapHandbook.html#acquisition-parameters"><i class="fa fa-check"></i><b>17.1</b> Acquisition parameters<span></span></a></li>
<li class="chapter" data-level="17.2" data-path="GCOrbitrapHandbook.html"><a href="GCOrbitrapHandbook.html#chemical-ionization"><i class="fa fa-check"></i><b>17.2</b> Chemical ionization<span></span></a></li>
<li class="chapter" data-level="17.3" data-path="GCOrbitrapHandbook.html"><a href="GCOrbitrapHandbook.html#terminologies-1"><i class="fa fa-check"></i><b>17.3</b> Terminologies<span></span></a></li>
<li class="chapter" data-level="17.4" data-path="GCOrbitrapHandbook.html"><a href="GCOrbitrapHandbook.html#cleaning-source"><i class="fa fa-check"></i><b>17.4</b> Cleaning source<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="reproducible-research-using-docker-containers-and-similar-tools.html"><a href="reproducible-research-using-docker-containers-and-similar-tools.html"><i class="fa fa-check"></i><b>18</b> Reproducible research using Docker containers and similar tools<span></span></a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Handbook of comprehensive suspect and nontarget workflows in environmental analysis using GC and LC-HRMS</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ExampleDust" class="section level1 hasAnchor" number="11">
<h1><span class="header-section-number">11</span> Example workflow: indoor dust<a href="ExampleDust.html#ExampleDust" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>A walkthrough for indoor dust analysis</p>
<p><br><br></p>
<div class="figure" style="text-align: center">
<div id="htmlwidget-944a1785ac4963b4c23c" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-944a1785ac4963b4c23c">{"x":{"diagram":"\ndigraph Scheme {\n      \n# graph statement\ngraph [layout = dot, overlap = false, rankdir = LR]\n\n# node statements\nnode [shape = box,\nfontname = Helvetica, fontsize = 35, style = filled]\n      \nnode [color = black, fillcolor = white, fixedsize = false]\n# A [label = \"Indoor dust collected \\n among different \\n use categories\"]\n# \n# node [color = black, fillcolor = white, fixedsize = false]\n# B1 [label = \"Collect different groups\"]\n# B2 [label = \"QA/QC\"]\n# \n# \n# node [color = black, fillcolor = white, fixedsize = false]\n# C1 [label = \"Sample different groups\"]\n# C2 [label = \"Suspect list of Cl/Br compounds\"]\n\nnode [color = black, fillcolor = white, fixedsize = false]\nD1 [label = \"Sample extraction\"]\nD1_1 [label = \"Hexane 3 mL\"]\nD1_2 [label = \"Hexane: Acetone (1:1) 3 mL\"]\nD1_3 [label = \"Toluene 3 mL\"]\nD2 [label = \"Combine and split 1:1\"]\nD3_1 [label = \"GC\"]\nD3_2 [label = \"LC\"]\nD4 [label = \"split 1:1\"]\n\n\n\nE1 [label = \"GC-HRMS\"]\nE2 [label = \"LC-HRMS\"]\n# \n# \n# node [color = black, fillcolor = white, fixedsize = false]\n# F1 [label = \"Suspect screening\"]\n# F2 [label = \"Nontarget\"]\n# \n# G1 [label = \"Mass defect plots\"]\n\n      \n      \n# edge statements\nedge [color = black]\n# A -> {B1}\n# B2 -> {C1}\n# B1 -> {C1 C2}\n# C1 -> {D1}\n\nD1 -> {D1_1}\nD1_1 -> {D1_2}\nD1_2 -> {D1_3}\nD1_1 -> {D2}\nD1_2 -> {D2}\nD2 -> {D3_1}\nD2 -> {D3_2}\nD3_1 -> {D4}\nD1_3 -> {D4}\n\nD3_2 -> {E2}\nD4 -> {E1}\nD1_3 -> {E1}\n      \n      }\n      ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
(#fig:example_workflows_dust)Workflow for nontarget using XX
</p>
</div>
<div id="htmlwidget-aff30042729cc554b85f" style="width:672px;height:480px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-aff30042729cc554b85f">{"x":{"diagram":"\ndigraph Scheme {\n      \n# graph statement\ngraph [layout = dot, overlap = false]\n\n# node statements\nnode [shape = box,\nfontname = Helvetica, fontsize = 35, style = filled]\n      \nnode [color = black, fillcolor = white, fixedsize = false]\n\nZERO [label = \"Deconvolution\"]\n\nA [label = \"Target analysis\"]\nB [label = \"Suspect list screening\"]\n\nC [label = \"NIST library screening\"]\nC1 [label = \"Molecular ion confirmation\"]\nC2 [label = \"Retention time index\"]\n\n\nD [label = \"Mass defect \\n (selected mz, rt and int of annotated compounds\"]\n\nsubgraph cluster2 {\nE [label = \"Annotation\"]\nID1 [label = \"Confirm EIC peaks\"]\n}\n\nF [label = \"Molecular networking \\n combine both suspect list msp with unknown msp. \\n\nHigh partial correlation gives indication on similar structure\"]\nG [label = \"Multivariate statistics\"]\n\nID2 [label = \"Peak/Component list with \\n partial annotation\"]\n\nQ1 [label = \"Semiquantify across samples\"]      \n      \n# edge statements\n\nedge [color = black]\n\nZERO -> {A B C}\nA -> {E}\nB -> {E}\n\n{C1 C2} -> {C}\nC -> {E}\n\nE -> {ID1}\nID1 -> {ID2}\nID2 -> {F}\nID2 -> {G}\nID2 -> {D}\nID2 -> {Q1}\n\n}\n","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
<p><br></p>
<div id="gc-orbitrap-hrms-workflow" class="section level2 hasAnchor" number="11.1">
<h2><span class="header-section-number">11.1</span> GC orbitrap HRMS workflow<a href="ExampleDust.html#gc-orbitrap-hrms-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This code uses XCMS with MF -&gt; CAMERA preprocessing used in : Stettin, D.; Poulin, R.X.; Pohnert, G. Metabolomics Benefits from Orbitrap GC–MS—Comparison of Low- and High-Resolution GC–MS. Metabolites 2020, 10, 143. See the supplementary material for original code. The code was modified here to also include retention time index and also remove zero intensity peaks after peak grouping. Additional metainformation for the msp file can also be added in the “extra” object.</p>
<p><br></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="ExampleDust.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(processx)</span>
<span id="cb17-2"><a href="ExampleDust.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xcms)</span>
<span id="cb17-3"><a href="ExampleDust.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CAMERA)</span>
<span id="cb17-4"><a href="ExampleDust.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(metaMS)</span>
<span id="cb17-5"><a href="ExampleDust.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb17-6"><a href="ExampleDust.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb17-7"><a href="ExampleDust.html#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="ExampleDust.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#first define the working directory (folder with experimental group folders inside)</span></span>
<span id="cb17-9"><a href="ExampleDust.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- list.files(path = &quot;/home/ORUNET.ORU.SE/twg/Dioxinlab/GC-Orbitrap data/Florian/Dust NTA 20200513/mzXML/&quot;,pattern = &quot;.mzXML&quot;, recursive = TRUE, full.names = TRUE)</span></span>
<span id="cb17-10"><a href="ExampleDust.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove files containing &quot;Hex&quot;, blank samples</span></span>
<span id="cb17-11"><a href="ExampleDust.html#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- mzMLfiles[-grep(&quot;Hex&quot;, mzMLfiles)]</span></span>
<span id="cb17-12"><a href="ExampleDust.html#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="ExampleDust.html#cb17-13" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;/home/ORUNET.ORU.SE/twg/Windows_home/Dust_Florian/Sample_list_NTA_dust.xlsx&quot;</span>,</span>
<span id="cb17-14"><a href="ExampleDust.html#cb17-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> <span class="st">&quot;Sample&quot;</span>)</span>
<span id="cb17-15"><a href="ExampleDust.html#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only samples</span></span>
<span id="cb17-16"><a href="ExampleDust.html#cb17-16" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb17-17"><a href="ExampleDust.html#cb17-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;blank_solvent&quot;</span>)))</span>
<span id="cb17-18"><a href="ExampleDust.html#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="ExampleDust.html#cb17-19" aria-hidden="true" tabindex="-1"></a>mzXMLfiles <span class="ot">&lt;-</span> <span class="fu">as.character</span>(sample_info<span class="sc">$</span>filename)</span>
<span id="cb17-20"><a href="ExampleDust.html#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="ExampleDust.html#cb17-21" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample_name =</span> <span class="fu">paste0</span>(sample_info<span class="sc">$</span>new_codes, <span class="st">&quot;.mzXML&quot;</span>),</span>
<span id="cb17-22"><a href="ExampleDust.html#cb17-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">class =</span> sample_info<span class="sc">$</span>group,</span>
<span id="cb17-23"><a href="ExampleDust.html#cb17-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-24"><a href="ExampleDust.html#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co"># pd &lt;- pd %&gt;% dplyr::filter(sample_group != &quot;IS&quot;) %&gt;% dplyr::filter(sample_group != &quot;RTI&quot;)</span></span>
<span id="cb17-25"><a href="ExampleDust.html#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="ExampleDust.html#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="ExampleDust.html#cb17-27" aria-hidden="true" tabindex="-1"></a>min.clustersize <span class="ot">&lt;-</span> <span class="dv">17</span> <span class="co">#how many fragments need to be in a group for it to be included in the results. 5 - trace compounds; 20 - mostly high quality spectra</span></span>
<span id="cb17-28"><a href="ExampleDust.html#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="fu">useOriginalCode</span>(<span class="cn">TRUE</span>) <span class="co">#otherwise matchedFilter will allocate a huge amount of RAM when using step = 0.001</span></span>
<span id="cb17-29"><a href="ExampleDust.html#cb17-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-30"><a href="ExampleDust.html#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#Refer to XCMS and CAMERA documentation for information about parameters and functions</span></span>
<span id="cb17-31"><a href="ExampleDust.html#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co">#These are the parameters used for high rez GC-Orbitrap data</span></span>
<span id="cb17-32"><a href="ExampleDust.html#cb17-32" aria-hidden="true" tabindex="-1"></a>xs1 <span class="ot">&lt;-</span> <span class="fu">xcmsSet</span>(mzXMLfiles, </span>
<span id="cb17-33"><a href="ExampleDust.html#cb17-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">phenoData =</span> pd,</span>
<span id="cb17-34"><a href="ExampleDust.html#cb17-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">method =</span> <span class="st">&quot;matchedFilter&quot;</span>, </span>
<span id="cb17-35"><a href="ExampleDust.html#cb17-35" aria-hidden="true" tabindex="-1"></a>               <span class="at">fwhm =</span> <span class="dv">3</span>, <span class="at">step =</span> <span class="fl">0.001</span>, </span>
<span id="cb17-36"><a href="ExampleDust.html#cb17-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">steps =</span> <span class="dv">2</span>, <span class="at">max =</span> <span class="dv">1000</span>, </span>
<span id="cb17-37"><a href="ExampleDust.html#cb17-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">snthresh =</span> <span class="dv">3</span>, <span class="at">mzdiff =</span> <span class="fl">0.002</span>)</span>
<span id="cb17-38"><a href="ExampleDust.html#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="ExampleDust.html#cb17-39" aria-hidden="true" tabindex="-1"></a>xs2 <span class="ot">&lt;-</span> <span class="fu">group</span>(xs1, <span class="at">method =</span> <span class="st">&quot;density&quot;</span>, <span class="at">bw =</span> <span class="dv">5</span>, <span class="at">mzwid =</span> <span class="fl">0.002</span>, <span class="at">minsamp =</span> <span class="dv">1</span>, <span class="at">minfrac =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1000</span>)</span>
<span id="cb17-40"><a href="ExampleDust.html#cb17-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-41"><a href="ExampleDust.html#cb17-41" aria-hidden="true" tabindex="-1"></a>xs3 <span class="ot">&lt;-</span> <span class="fu">retcor</span>(xs2, <span class="at">method =</span> <span class="st">&quot;obiwarp&quot;</span>)</span>
<span id="cb17-42"><a href="ExampleDust.html#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="ExampleDust.html#cb17-43" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">group</span>(xs3, <span class="at">method =</span> <span class="st">&quot;density&quot;</span>, <span class="at">bw =</span> <span class="dv">2</span>, <span class="at">mzwid =</span> <span class="fl">0.6</span>, <span class="at">minsamp =</span> <span class="dv">1</span>, <span class="at">minfrac =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1000</span>)</span>
<span id="cb17-44"><a href="ExampleDust.html#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="ExampleDust.html#cb17-45" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">group</span>(xs3, <span class="at">method =</span> <span class="st">&quot;density&quot;</span>, <span class="at">bw =</span> <span class="dv">2</span>, <span class="at">mzwid =</span> <span class="fl">0.002</span>, <span class="at">minsamp =</span> <span class="dv">1</span>, <span class="at">minfrac =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1000</span>)</span>
<span id="cb17-46"><a href="ExampleDust.html#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="ExampleDust.html#cb17-47" aria-hidden="true" tabindex="-1"></a>xs5 <span class="ot">&lt;-</span> <span class="fu">fillPeaks</span>(xs4)</span>
<span id="cb17-48"><a href="ExampleDust.html#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="ExampleDust.html#cb17-49" aria-hidden="true" tabindex="-1"></a>xs6 <span class="ot">&lt;-</span> <span class="fu">xsAnnotate</span>(<span class="at">xs =</span> xs5, <span class="at">sample=</span><span class="cn">NA</span>, <span class="at">polarity =</span> <span class="st">&quot;positive&quot;</span>)</span>
<span id="cb17-50"><a href="ExampleDust.html#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="ExampleDust.html#cb17-51" aria-hidden="true" tabindex="-1"></a>xs7 <span class="ot">&lt;-</span> <span class="fu">groupFWHM</span>(xs6, <span class="at">sigma =</span> <span class="dv">6</span> , <span class="at">perfwhm =</span> <span class="dv">2</span>, <span class="at">intval =</span> <span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb17-52"><a href="ExampleDust.html#cb17-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-53"><a href="ExampleDust.html#cb17-53" aria-hidden="true" tabindex="-1"></a>xs8 <span class="ot">&lt;-</span> <span class="fu">groupCorr</span>(xs7, <span class="at">cor_eic_th =</span> <span class="fl">0.8</span>, <span class="at">calcCaS =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-54"><a href="ExampleDust.html#cb17-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-55"><a href="ExampleDust.html#cb17-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-56"><a href="ExampleDust.html#cb17-56" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;into&quot;</span>)</span>
<span id="cb17-57"><a href="ExampleDust.html#cb17-57" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(peaktable, <span class="at">file =</span> <span class="st">&quot;untreated_peaktable_MatchedFilter.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with all m/z features sorted into &quot;compounds&quot;</span></span>
<span id="cb17-58"><a href="ExampleDust.html#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="ExampleDust.html#cb17-59" aria-hidden="true" tabindex="-1"></a><span class="co">#the following script identifies all &quot;compounds&quot; considered too small according to min.clustersize</span></span>
<span id="cb17-60"><a href="ExampleDust.html#cb17-60" aria-hidden="true" tabindex="-1"></a><span class="co">#you don&#39;t need to modify anything, that run the next part as is</span></span>
<span id="cb17-61"><a href="ExampleDust.html#cb17-61" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb17-62"><a href="ExampleDust.html#cb17-62" aria-hidden="true" tabindex="-1"></a>pcgroups <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(peaktable<span class="sc">$</span>pcgroup)))</span>
<span id="cb17-63"><a href="ExampleDust.html#cb17-63" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-64"><a href="ExampleDust.html#cb17-64" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-65"><a href="ExampleDust.html#cb17-65" aria-hidden="true" tabindex="-1"></a>small.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-66"><a href="ExampleDust.html#cb17-66" aria-hidden="true" tabindex="-1"></a>big.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-67"><a href="ExampleDust.html#cb17-67" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-68"><a href="ExampleDust.html#cb17-68" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> pcgroups) {</span>
<span id="cb17-69"><a href="ExampleDust.html#cb17-69" aria-hidden="true" tabindex="-1"></a>  clustersize <span class="ot">&lt;-</span> <span class="fu">length</span>(peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,<span class="fu">ncol</span>(peaktable)])</span>
<span id="cb17-70"><a href="ExampleDust.html#cb17-70" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(clustersize <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(min.clustersize))</span>
<span id="cb17-71"><a href="ExampleDust.html#cb17-71" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb17-72"><a href="ExampleDust.html#cb17-72" aria-hidden="true" tabindex="-1"></a>    small.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(small.clusters, x)</span>
<span id="cb17-73"><a href="ExampleDust.html#cb17-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-74"><a href="ExampleDust.html#cb17-74" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb17-75"><a href="ExampleDust.html#cb17-75" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb17-76"><a href="ExampleDust.html#cb17-76" aria-hidden="true" tabindex="-1"></a>    big.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(big.clusters, x)</span>
<span id="cb17-77"><a href="ExampleDust.html#cb17-77" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,]</span>
<span id="cb17-78"><a href="ExampleDust.html#cb17-78" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">3</span><span class="sc">-</span>(<span class="fu">length</span>(mzXMLfiles))))]</span>
<span id="cb17-79"><a href="ExampleDust.html#cb17-79" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">2</span>))]</span>
<span id="cb17-80"><a href="ExampleDust.html#cb17-80" aria-hidden="true" tabindex="-1"></a>    decider <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb17-81"><a href="ExampleDust.html#cb17-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(gruppe1))</span>
<span id="cb17-82"><a href="ExampleDust.html#cb17-82" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb17-83"><a href="ExampleDust.html#cb17-83" aria-hidden="true" tabindex="-1"></a>      decider <span class="ot">&lt;-</span> <span class="fu">c</span>(decider, <span class="fu">sum</span>(gruppe1[, i]))</span>
<span id="cb17-84"><a href="ExampleDust.html#cb17-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-85"><a href="ExampleDust.html#cb17-85" aria-hidden="true" tabindex="-1"></a>    highest <span class="ot">&lt;-</span> <span class="fu">which</span>(decider<span class="sc">==</span><span class="fu">max</span>(decider), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-86"><a href="ExampleDust.html#cb17-86" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(gruppe1[, <span class="dv">1</span>], gruppe1[, highest[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb17-87"><a href="ExampleDust.html#cb17-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(gruppe1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mz&quot;</span>, <span class="st">&quot;int&quot;</span>)</span>
<span id="cb17-88"><a href="ExampleDust.html#cb17-88" aria-hidden="true" tabindex="-1"></a>    lspectra[[n]] <span class="ot">&lt;-</span> gruppe1</span>
<span id="cb17-89"><a href="ExampleDust.html#cb17-89" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb17-90"><a href="ExampleDust.html#cb17-90" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-91"><a href="ExampleDust.html#cb17-91" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-92"><a href="ExampleDust.html#cb17-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-93"><a href="ExampleDust.html#cb17-93" aria-hidden="true" tabindex="-1"></a><span class="co"># remove peaks with zero intensities</span></span>
<span id="cb17-94"><a href="ExampleDust.html#cb17-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-95"><a href="ExampleDust.html#cb17-95" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lspectra, <span class="cf">function</span>(x) {x[x<span class="sc">$</span>int <span class="sc">!=</span> <span class="dv">0</span>,]})</span>
<span id="cb17-96"><a href="ExampleDust.html#cb17-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-97"><a href="ExampleDust.html#cb17-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-98"><a href="ExampleDust.html#cb17-98" aria-hidden="true" tabindex="-1"></a>reduced.peaktable <span class="ot">&lt;-</span> <span class="fu">getReducedPeaklist</span>(xs8, <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">intval =</span> <span class="st">&quot;into&quot;</span>, <span class="at">default.adduct.info =</span> <span class="st">&quot;maxint&quot;</span>, <span class="at">mzrt.range =</span> <span class="cn">FALSE</span>, <span class="at">npeaks.sum =</span> <span class="cn">FALSE</span>, <span class="at">cleanup =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-99"><a href="ExampleDust.html#cb17-99" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(small.clusters)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb17-100"><a href="ExampleDust.html#cb17-100" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(z <span class="cf">in</span> small.clusters)</span>
<span id="cb17-101"><a href="ExampleDust.html#cb17-101" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb17-102"><a href="ExampleDust.html#cb17-102" aria-hidden="true" tabindex="-1"></a>    reduced.peaktable <span class="ot">&lt;-</span> reduced.peaktable[<span class="sc">-</span>(<span class="fu">which</span>(reduced.peaktable[, <span class="fu">ncol</span>(reduced.peaktable)]<span class="sc">==</span>z)), ]</span>
<span id="cb17-103"><a href="ExampleDust.html#cb17-103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-104"><a href="ExampleDust.html#cb17-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-105"><a href="ExampleDust.html#cb17-105" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(reduced.peaktable, <span class="at">file =</span> <span class="st">&quot;peaktable_MatchedFilter.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with only &quot;compounds&quot; instead of m/z features</span></span>
<span id="cb17-106"><a href="ExampleDust.html#cb17-106" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="fu">paste</span>(<span class="st">&quot;Unknown&quot;</span>, big.clusters, <span class="st">&quot;RT =&quot;</span>,<span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>) ), <span class="at">Class =</span> <span class="st">&quot;Unknown&quot;</span>, <span class="at">RT =</span> <span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>),  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-107"><a href="ExampleDust.html#cb17-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-108"><a href="ExampleDust.html#cb17-108" aria-hidden="true" tabindex="-1"></a><span class="do">####KOVATS#####</span></span>
<span id="cb17-109"><a href="ExampleDust.html#cb17-109" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding Kovats retention index to the extra obejct to write to msp</span></span>
<span id="cb17-110"><a href="ExampleDust.html#cb17-110" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rt =</span> extra<span class="sc">$</span>RT)</span>
<span id="cb17-111"><a href="ExampleDust.html#cb17-111" aria-hidden="true" tabindex="-1"></a>alkaneSeries <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Num =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">25</span>),</span>
<span id="cb17-112"><a href="ExampleDust.html#cb17-112" aria-hidden="true" tabindex="-1"></a>                           <span class="at">rt =</span> <span class="fu">c</span>(<span class="fl">4.90</span>, <span class="fl">8.00</span>, <span class="fl">11.13</span>, <span class="fl">14.05</span>, <span class="fl">16.70</span>, <span class="fl">19.37</span>, <span class="fl">22.45</span>, <span class="fl">25.77</span>))</span>
<span id="cb17-113"><a href="ExampleDust.html#cb17-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-114"><a href="ExampleDust.html#cb17-114" aria-hidden="true" tabindex="-1"></a>RI <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="fu">nrow</span>(data))</span>
<span id="cb17-115"><a href="ExampleDust.html#cb17-115" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data))) {</span>
<span id="cb17-116"><a href="ExampleDust.html#cb17-116" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb17-117"><a href="ExampleDust.html#cb17-117" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">1</span>],</span>
<span id="cb17-118"><a href="ExampleDust.html#cb17-118" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb17-119"><a href="ExampleDust.html#cb17-119" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb17-120"><a href="ExampleDust.html#cb17-120" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb17-121"><a href="ExampleDust.html#cb17-121" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb17-122"><a href="ExampleDust.html#cb17-122" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb17-123"><a href="ExampleDust.html#cb17-123" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>]</span>
<span id="cb17-124"><a href="ExampleDust.html#cb17-124" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-125"><a href="ExampleDust.html#cb17-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-126"><a href="ExampleDust.html#cb17-126" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb17-127"><a href="ExampleDust.html#cb17-127" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb17-128"><a href="ExampleDust.html#cb17-128" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb17-129"><a href="ExampleDust.html#cb17-129" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb17-130"><a href="ExampleDust.html#cb17-130" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb17-131"><a href="ExampleDust.html#cb17-131" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb17-132"><a href="ExampleDust.html#cb17-132" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>],</span>
<span id="cb17-133"><a href="ExampleDust.html#cb17-133" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">8</span>]</span>
<span id="cb17-134"><a href="ExampleDust.html#cb17-134" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-135"><a href="ExampleDust.html#cb17-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-136"><a href="ExampleDust.html#cb17-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-137"><a href="ExampleDust.html#cb17-137" aria-hidden="true" tabindex="-1"></a>RI[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>n <span class="sc">+</span> <span class="dv">100</span><span class="sc">*</span>(m<span class="sc">-</span>n) <span class="sc">*</span> (data<span class="sc">$</span>rt[i] <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt)<span class="sc">/</span>(alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> m,]<span class="sc">$</span>rt <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt), <span class="dv">0</span>)</span>
<span id="cb17-138"><a href="ExampleDust.html#cb17-138" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-139"><a href="ExampleDust.html#cb17-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-140"><a href="ExampleDust.html#cb17-140" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">cbind</span>(extra, RI)</span>
<span id="cb17-141"><a href="ExampleDust.html#cb17-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-142"><a href="ExampleDust.html#cb17-142" aria-hidden="true" tabindex="-1"></a><span class="do">######</span><span class="re">END</span><span class="do"> KOVATS######</span></span>
<span id="cb17-143"><a href="ExampleDust.html#cb17-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-144"><a href="ExampleDust.html#cb17-144" aria-hidden="true" tabindex="-1"></a><span class="co"># create the msp object with spectra and all meta information in the extra object (NAME, RETENTIONTIME, RETENTIONINDEX)</span></span>
<span id="cb17-145"><a href="ExampleDust.html#cb17-145" aria-hidden="true" tabindex="-1"></a>export.msp <span class="ot">&lt;-</span> <span class="fu">construct.msp</span>(lspectra, extra)</span>
<span id="cb17-146"><a href="ExampleDust.html#cb17-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-147"><a href="ExampleDust.html#cb17-147" aria-hidden="true" tabindex="-1"></a><span class="fu">write.msp</span>(export.msp, <span class="at">file =</span> <span class="st">&quot;spectra_MatchedFilter20201030.msp&quot;</span>) <span class="co">#This creates a NIST MS Search compatible .msp file with all compound pseudospectra</span></span></code></pre></div>
<p>This code uses XCMS with centWave. Check differences and skip first steps to combine both workflows</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="ExampleDust.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#first define the working directory (folder with experimental group folders inside)</span></span>
<span id="cb18-2"><a href="ExampleDust.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- list.files(path = &quot;/mzXML/&quot;,pattern = &quot;.mzXML&quot;, recursive = TRUE, full.names = TRUE)</span></span>
<span id="cb18-3"><a href="ExampleDust.html#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove files containing &quot;Hex&quot;, blank samples</span></span>
<span id="cb18-4"><a href="ExampleDust.html#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mzMLfiles &lt;- mzMLfiles[-grep(&quot;Hex&quot;, mzMLfiles)]</span></span>
<span id="cb18-5"><a href="ExampleDust.html#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="ExampleDust.html#cb18-6" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;Sample_list_NTA_dust.xlsx&quot;</span>,</span>
<span id="cb18-7"><a href="ExampleDust.html#cb18-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sheet =</span> <span class="st">&quot;Sample_xcms&quot;</span>)</span>
<span id="cb18-8"><a href="ExampleDust.html#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># filter only samples</span></span>
<span id="cb18-9"><a href="ExampleDust.html#cb18-9" aria-hidden="true" tabindex="-1"></a>sample_info <span class="ot">&lt;-</span> sample_info <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="ExampleDust.html#cb18-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;blank_solvent&quot;</span>)))</span>
<span id="cb18-11"><a href="ExampleDust.html#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="ExampleDust.html#cb18-12" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sample_name =</span> <span class="fu">paste0</span>(sample_info<span class="sc">$</span>analysis, <span class="st">&quot;.mzXML&quot;</span>),</span>
<span id="cb18-13"><a href="ExampleDust.html#cb18-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sample_group =</span> sample_info<span class="sc">$</span>group,</span>
<span id="cb18-14"><a href="ExampleDust.html#cb18-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-15"><a href="ExampleDust.html#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="ExampleDust.html#cb18-16" aria-hidden="true" tabindex="-1"></a>mzXMLfiles <span class="ot">&lt;-</span> <span class="fu">paste0</span>(sample_info<span class="sc">$</span>path, <span class="st">&quot;/&quot;</span>, sample_info<span class="sc">$</span>analysis, <span class="st">&quot;.mzXML&quot;</span>)</span>
<span id="cb18-17"><a href="ExampleDust.html#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="ExampleDust.html#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="ExampleDust.html#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="ExampleDust.html#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Use subset to test</span></span>
<span id="cb18-21"><a href="ExampleDust.html#cb18-21" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> pd[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,]</span>
<span id="cb18-22"><a href="ExampleDust.html#cb18-22" aria-hidden="true" tabindex="-1"></a>mzXMLfiles <span class="ot">&lt;-</span> mzXMLfiles[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span>
<span id="cb18-23"><a href="ExampleDust.html#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="ExampleDust.html#cb18-24" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">readMSData</span>(mzXMLfiles, </span>
<span id="cb18-25"><a href="ExampleDust.html#cb18-25" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pdata =</span> <span class="fu">new</span>(<span class="st">&quot;NAnnotatedDataFrame&quot;</span>, pd),</span>
<span id="cb18-26"><a href="ExampleDust.html#cb18-26" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mode =</span> <span class="st">&quot;onDisk&quot;</span>)</span>
<span id="cb18-27"><a href="ExampleDust.html#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="ExampleDust.html#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co"># pd &lt;- pd %&gt;% dplyr::filter(sample_group != &quot;IS&quot;) %&gt;% dplyr::filter(sample_group != &quot;RTI&quot;)</span></span>
<span id="cb18-29"><a href="ExampleDust.html#cb18-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-30"><a href="ExampleDust.html#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="co">#-----Find features----#</span></span>
<span id="cb18-31"><a href="ExampleDust.html#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="ExampleDust.html#cb18-32" aria-hidden="true" tabindex="-1"></a><span class="co"># centWave params</span></span>
<span id="cb18-33"><a href="ExampleDust.html#cb18-33" aria-hidden="true" tabindex="-1"></a>cwp <span class="ot">&lt;-</span> <span class="fu">CentWaveParam</span>(<span class="at">ppm =</span> <span class="dv">5</span>,</span>
<span id="cb18-34"><a href="ExampleDust.html#cb18-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">peakwidth =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">45</span>),</span>
<span id="cb18-35"><a href="ExampleDust.html#cb18-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">snthresh =</span> <span class="dv">10</span>,</span>
<span id="cb18-36"><a href="ExampleDust.html#cb18-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">prefilter =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">30000</span>),</span>
<span id="cb18-37"><a href="ExampleDust.html#cb18-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mzCenterFun =</span> <span class="st">&quot;wMean&quot;</span>,</span>
<span id="cb18-38"><a href="ExampleDust.html#cb18-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">integrate =</span> 1L,</span>
<span id="cb18-39"><a href="ExampleDust.html#cb18-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mzdiff =</span> <span class="sc">-</span><span class="fl">0.001</span>,</span>
<span id="cb18-40"><a href="ExampleDust.html#cb18-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fitgauss =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-41"><a href="ExampleDust.html#cb18-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">noise =</span> <span class="dv">30000</span>,</span>
<span id="cb18-42"><a href="ExampleDust.html#cb18-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verboseColumns =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-43"><a href="ExampleDust.html#cb18-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-44"><a href="ExampleDust.html#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="ExampleDust.html#cb18-45" aria-hidden="true" tabindex="-1"></a>xs1 <span class="ot">&lt;-</span> <span class="fu">findChromPeaks</span>(mzXMLfiles, <span class="at">param =</span> cwp)</span>
<span id="cb18-46"><a href="ExampleDust.html#cb18-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-47"><a href="ExampleDust.html#cb18-47" aria-hidden="true" tabindex="-1"></a><span class="co"># use model peak to evaluate process</span></span>
<span id="cb18-48"><a href="ExampleDust.html#cb18-48" aria-hidden="true" tabindex="-1"></a>rtr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1440</span>, <span class="dv">1460</span>)</span>
<span id="cb18-49"><a href="ExampleDust.html#cb18-49" aria-hidden="true" tabindex="-1"></a>mzr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">340.238</span>, <span class="fl">340.242</span>)</span>
<span id="cb18-50"><a href="ExampleDust.html#cb18-50" aria-hidden="true" tabindex="-1"></a>chr_raw <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(mzXMLfiles, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb18-51"><a href="ExampleDust.html#cb18-51" aria-hidden="true" tabindex="-1"></a>chr_mzr <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs1, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb18-52"><a href="ExampleDust.html#cb18-52" aria-hidden="true" tabindex="-1"></a>group_colors <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">brewer.pal</span>(<span class="dv">3</span>, <span class="st">&quot;Set1&quot;</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="st">&quot;60&quot;</span>)</span>
<span id="cb18-53"><a href="ExampleDust.html#cb18-53" aria-hidden="true" tabindex="-1"></a>sample_colors <span class="ot">&lt;-</span> group_colors[xs1<span class="sc">$</span>sample_group]</span>
<span id="cb18-54"><a href="ExampleDust.html#cb18-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-55"><a href="ExampleDust.html#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="ExampleDust.html#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="co">#----Group features 1----#</span></span>
<span id="cb18-57"><a href="ExampleDust.html#cb18-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-58"><a href="ExampleDust.html#cb18-58" aria-hidden="true" tabindex="-1"></a>pdp <span class="ot">&lt;-</span> <span class="fu">PeakDensityParam</span>(</span>
<span id="cb18-59"><a href="ExampleDust.html#cb18-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleGroups =</span> pd<span class="sc">$</span>sample_group,</span>
<span id="cb18-60"><a href="ExampleDust.html#cb18-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> <span class="dv">10</span>,</span>
<span id="cb18-61"><a href="ExampleDust.html#cb18-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">minFraction =</span> <span class="dv">0</span>,</span>
<span id="cb18-62"><a href="ExampleDust.html#cb18-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">minSamples =</span> <span class="dv">1</span>,</span>
<span id="cb18-63"><a href="ExampleDust.html#cb18-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">binSize =</span> <span class="fl">0.002</span>,</span>
<span id="cb18-64"><a href="ExampleDust.html#cb18-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxFeatures =</span> <span class="dv">1000</span>)</span>
<span id="cb18-65"><a href="ExampleDust.html#cb18-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-66"><a href="ExampleDust.html#cb18-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-67"><a href="ExampleDust.html#cb18-67" aria-hidden="true" tabindex="-1"></a>xs2 <span class="ot">&lt;-</span> <span class="fu">groupChromPeaks</span>(xs1, <span class="at">param =</span> pdp)</span>
<span id="cb18-68"><a href="ExampleDust.html#cb18-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-69"><a href="ExampleDust.html#cb18-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-70"><a href="ExampleDust.html#cb18-70" aria-hidden="true" tabindex="-1"></a><span class="fu">plotChromPeakDensity</span>(chr_mzr, <span class="at">col =</span> sample_colors, <span class="at">param =</span> pdp)</span>
<span id="cb18-71"><a href="ExampleDust.html#cb18-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-72"><a href="ExampleDust.html#cb18-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-73"><a href="ExampleDust.html#cb18-73" aria-hidden="true" tabindex="-1"></a><span class="co">#----retention time correction----#</span></span>
<span id="cb18-74"><a href="ExampleDust.html#cb18-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-75"><a href="ExampleDust.html#cb18-75" aria-hidden="true" tabindex="-1"></a>obip <span class="ot">&lt;-</span> <span class="fu">ObiwarpParam</span>(<span class="at">binSize =</span> <span class="fl">0.05</span>,  <span class="co"># need to check optimal binSize</span></span>
<span id="cb18-76"><a href="ExampleDust.html#cb18-76" aria-hidden="true" tabindex="-1"></a>                     <span class="at">centerSample =</span> <span class="fu">integer</span>(),</span>
<span id="cb18-77"><a href="ExampleDust.html#cb18-77" aria-hidden="true" tabindex="-1"></a>                     <span class="at">response =</span> 1L,</span>
<span id="cb18-78"><a href="ExampleDust.html#cb18-78" aria-hidden="true" tabindex="-1"></a>                     <span class="at">distFun =</span> <span class="st">&quot;cor_opt&quot;</span>,</span>
<span id="cb18-79"><a href="ExampleDust.html#cb18-79" aria-hidden="true" tabindex="-1"></a>                     <span class="at">gapInit =</span> <span class="fu">numeric</span>(),</span>
<span id="cb18-80"><a href="ExampleDust.html#cb18-80" aria-hidden="true" tabindex="-1"></a>                     <span class="at">gapExtend =</span> <span class="fu">numeric</span>(),</span>
<span id="cb18-81"><a href="ExampleDust.html#cb18-81" aria-hidden="true" tabindex="-1"></a>                     <span class="at">factorDiag =</span> <span class="dv">2</span>,</span>
<span id="cb18-82"><a href="ExampleDust.html#cb18-82" aria-hidden="true" tabindex="-1"></a>                     <span class="at">factorGap =</span> <span class="dv">1</span>,</span>
<span id="cb18-83"><a href="ExampleDust.html#cb18-83" aria-hidden="true" tabindex="-1"></a>                     <span class="at">localAlignment =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-84"><a href="ExampleDust.html#cb18-84" aria-hidden="true" tabindex="-1"></a>                     <span class="at">initPenalty =</span> <span class="dv">0</span>,</span>
<span id="cb18-85"><a href="ExampleDust.html#cb18-85" aria-hidden="true" tabindex="-1"></a>                     <span class="at">subset =</span> <span class="fu">integer</span>(),</span>
<span id="cb18-86"><a href="ExampleDust.html#cb18-86" aria-hidden="true" tabindex="-1"></a>                     <span class="at">subsetAdjust =</span> <span class="fu">c</span>(<span class="st">&quot;average&quot;</span>, <span class="st">&quot;previous&quot;</span>))</span>
<span id="cb18-87"><a href="ExampleDust.html#cb18-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-88"><a href="ExampleDust.html#cb18-88" aria-hidden="true" tabindex="-1"></a>xs3 <span class="ot">&lt;-</span> <span class="fu">adjustRtime</span>(xs2, <span class="at">param =</span> obip)</span>
<span id="cb18-89"><a href="ExampleDust.html#cb18-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-90"><a href="ExampleDust.html#cb18-90" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the base peak chromatograms</span></span>
<span id="cb18-91"><a href="ExampleDust.html#cb18-91" aria-hidden="true" tabindex="-1"></a>bpis_adj <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs3, <span class="at">aggregationFun =</span> <span class="st">&quot;max&quot;</span>, <span class="at">include =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb18-92"><a href="ExampleDust.html#cb18-92" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">4.5</span>, <span class="fl">4.2</span>, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb18-93"><a href="ExampleDust.html#cb18-93" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(bpis_adj)</span>
<span id="cb18-94"><a href="ExampleDust.html#cb18-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot also the difference of adjusted to raw retention time.</span></span>
<span id="cb18-95"><a href="ExampleDust.html#cb18-95" aria-hidden="true" tabindex="-1"></a><span class="fu">plotAdjustedRtime</span>(xs3)</span>
<span id="cb18-96"><a href="ExampleDust.html#cb18-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-97"><a href="ExampleDust.html#cb18-97" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb18-98"><a href="ExampleDust.html#cb18-98" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the raw data</span></span>
<span id="cb18-99"><a href="ExampleDust.html#cb18-99" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chr_raw)</span>
<span id="cb18-100"><a href="ExampleDust.html#cb18-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-101"><a href="ExampleDust.html#cb18-101" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract the chromatogram from the adjusted object</span></span>
<span id="cb18-102"><a href="ExampleDust.html#cb18-102" aria-hidden="true" tabindex="-1"></a>chr_adj <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs3, <span class="at">rt =</span> rtr, <span class="at">mz =</span> mzr)</span>
<span id="cb18-103"><a href="ExampleDust.html#cb18-103" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chr_adj, <span class="at">peakType =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb18-104"><a href="ExampleDust.html#cb18-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-105"><a href="ExampleDust.html#cb18-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-106"><a href="ExampleDust.html#cb18-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-107"><a href="ExampleDust.html#cb18-107" aria-hidden="true" tabindex="-1"></a><span class="co">#----Group features 2----#</span></span>
<span id="cb18-108"><a href="ExampleDust.html#cb18-108" aria-hidden="true" tabindex="-1"></a><span class="co"># After retention time correction, the rt values are modified and additional grouping is needed.</span></span>
<span id="cb18-109"><a href="ExampleDust.html#cb18-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-110"><a href="ExampleDust.html#cb18-110" aria-hidden="true" tabindex="-1"></a>pdp2 <span class="ot">&lt;-</span> <span class="fu">PeakDensityParam</span>(</span>
<span id="cb18-111"><a href="ExampleDust.html#cb18-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleGroups =</span> pd<span class="sc">$</span>sample_group,</span>
<span id="cb18-112"><a href="ExampleDust.html#cb18-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> <span class="dv">5</span>,</span>
<span id="cb18-113"><a href="ExampleDust.html#cb18-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">minFraction =</span> <span class="dv">0</span>,</span>
<span id="cb18-114"><a href="ExampleDust.html#cb18-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">minSamples =</span> <span class="dv">1</span>,</span>
<span id="cb18-115"><a href="ExampleDust.html#cb18-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">binSize =</span> <span class="fl">0.2</span>,</span>
<span id="cb18-116"><a href="ExampleDust.html#cb18-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxFeatures =</span> <span class="dv">1000</span>)</span>
<span id="cb18-117"><a href="ExampleDust.html#cb18-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-118"><a href="ExampleDust.html#cb18-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-119"><a href="ExampleDust.html#cb18-119" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">groupChromPeaks</span>(xs3, <span class="at">param =</span> pdp2)</span>
<span id="cb18-120"><a href="ExampleDust.html#cb18-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-121"><a href="ExampleDust.html#cb18-121" aria-hidden="true" tabindex="-1"></a>xs4_chrom <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs4, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb18-122"><a href="ExampleDust.html#cb18-122" aria-hidden="true" tabindex="-1"></a><span class="fu">plotChromPeakDensity</span>(xs4_chrom, <span class="at">col =</span> sample_colors, <span class="at">param =</span> pdp2)</span>
<span id="cb18-123"><a href="ExampleDust.html#cb18-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-124"><a href="ExampleDust.html#cb18-124" aria-hidden="true" tabindex="-1"></a><span class="co"># iteratively decrease the binSize</span></span>
<span id="cb18-125"><a href="ExampleDust.html#cb18-125" aria-hidden="true" tabindex="-1"></a>pdp3 <span class="ot">&lt;-</span> <span class="fu">PeakDensityParam</span>(</span>
<span id="cb18-126"><a href="ExampleDust.html#cb18-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">sampleGroups =</span> pd<span class="sc">$</span>sample_group,</span>
<span id="cb18-127"><a href="ExampleDust.html#cb18-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">bw =</span> <span class="dv">2</span>,</span>
<span id="cb18-128"><a href="ExampleDust.html#cb18-128" aria-hidden="true" tabindex="-1"></a>  <span class="at">minFraction =</span> <span class="dv">0</span>,</span>
<span id="cb18-129"><a href="ExampleDust.html#cb18-129" aria-hidden="true" tabindex="-1"></a>  <span class="at">minSamples =</span> <span class="dv">1</span>,</span>
<span id="cb18-130"><a href="ExampleDust.html#cb18-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">binSize =</span> <span class="fl">0.002</span>,</span>
<span id="cb18-131"><a href="ExampleDust.html#cb18-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">maxFeatures =</span> <span class="dv">1000</span>)</span>
<span id="cb18-132"><a href="ExampleDust.html#cb18-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-133"><a href="ExampleDust.html#cb18-133" aria-hidden="true" tabindex="-1"></a>xs4 <span class="ot">&lt;-</span> <span class="fu">groupChromPeaks</span>(xs4, <span class="at">param =</span> pdp3)</span>
<span id="cb18-134"><a href="ExampleDust.html#cb18-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-135"><a href="ExampleDust.html#cb18-135" aria-hidden="true" tabindex="-1"></a>xs4_chrom <span class="ot">&lt;-</span> <span class="fu">chromatogram</span>(xs4, <span class="at">mz =</span> mzr, <span class="at">rt =</span> rtr)</span>
<span id="cb18-136"><a href="ExampleDust.html#cb18-136" aria-hidden="true" tabindex="-1"></a><span class="fu">plotChromPeakDensity</span>(xs4_chrom, <span class="at">col =</span> sample_colors, <span class="at">param =</span> pdp3)</span>
<span id="cb18-137"><a href="ExampleDust.html#cb18-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-138"><a href="ExampleDust.html#cb18-138" aria-hidden="true" tabindex="-1"></a><span class="co">#----Fill missing features----#</span></span>
<span id="cb18-139"><a href="ExampleDust.html#cb18-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-140"><a href="ExampleDust.html#cb18-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-141"><a href="ExampleDust.html#cb18-141" aria-hidden="true" tabindex="-1"></a>xs5 <span class="ot">&lt;-</span> <span class="fu">fillChromPeaks</span>(xs4)</span>
<span id="cb18-142"><a href="ExampleDust.html#cb18-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-143"><a href="ExampleDust.html#cb18-143" aria-hidden="true" tabindex="-1"></a><span class="do">## Check missing values before filling in peaks</span></span>
<span id="cb18-144"><a href="ExampleDust.html#cb18-144" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">featureValues</span>(xs5, <span class="at">filled =</span> <span class="cn">FALSE</span>), <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb18-145"><a href="ExampleDust.html#cb18-145" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="cf">function</span>(z) <span class="fu">sum</span>(<span class="fu">is.na</span>(z)))</span>
<span id="cb18-146"><a href="ExampleDust.html#cb18-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-147"><a href="ExampleDust.html#cb18-147" aria-hidden="true" tabindex="-1"></a><span class="do">## Missing values after filling in peaks</span></span>
<span id="cb18-148"><a href="ExampleDust.html#cb18-148" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">featureValues</span>(xs5), <span class="at">MARGIN =</span> <span class="dv">2</span>,</span>
<span id="cb18-149"><a href="ExampleDust.html#cb18-149" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> <span class="cf">function</span>(z) <span class="fu">sum</span>(<span class="fu">is.na</span>(z)))</span>
<span id="cb18-150"><a href="ExampleDust.html#cb18-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-151"><a href="ExampleDust.html#cb18-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-152"><a href="ExampleDust.html#cb18-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-153"><a href="ExampleDust.html#cb18-153" aria-hidden="true" tabindex="-1"></a><span class="co">#---- QC ----#</span></span>
<span id="cb18-154"><a href="ExampleDust.html#cb18-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-155"><a href="ExampleDust.html#cb18-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract chromatograms of 4 features</span></span>
<span id="cb18-156"><a href="ExampleDust.html#cb18-156" aria-hidden="true" tabindex="-1"></a>feature_chroms <span class="ot">&lt;-</span> <span class="fu">featureChromatograms</span>(xs5, <span class="at">features =</span> <span class="dv">10000</span><span class="sc">:</span><span class="dv">10004</span>)</span>
<span id="cb18-157"><a href="ExampleDust.html#cb18-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-158"><a href="ExampleDust.html#cb18-158" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(feature_chroms)</span>
<span id="cb18-159"><a href="ExampleDust.html#cb18-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-160"><a href="ExampleDust.html#cb18-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-161"><a href="ExampleDust.html#cb18-161" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">featureValues</span>(xs5, <span class="at">value=</span><span class="st">&quot;into&quot;</span>) <span class="sc">+</span><span class="dv">1</span>, </span>
<span id="cb18-162"><a href="ExampleDust.html#cb18-162" aria-hidden="true" tabindex="-1"></a>        <span class="co">#col=as.numeric(sampclass(mtbls2Set))+1, </span></span>
<span id="cb18-163"><a href="ExampleDust.html#cb18-163" aria-hidden="true" tabindex="-1"></a>        <span class="at">log=</span><span class="st">&quot;y&quot;</span>, <span class="at">las=</span><span class="dv">2</span>)</span>
<span id="cb18-164"><a href="ExampleDust.html#cb18-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-165"><a href="ExampleDust.html#cb18-165" aria-hidden="true" tabindex="-1"></a>sdThresh <span class="ot">&lt;-</span> <span class="fl">4.0</span> <span class="do">## Filter low-standard deviation rows for plot</span></span>
<span id="cb18-166"><a href="ExampleDust.html#cb18-166" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="fu">featureValues</span>(xs5))<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb18-167"><a href="ExampleDust.html#cb18-167" aria-hidden="true" tabindex="-1"></a>pca.result <span class="ot">&lt;-</span> <span class="fu">pca</span>(data, <span class="at">nPcs=</span><span class="dv">3</span>)</span>
<span id="cb18-168"><a href="ExampleDust.html#cb18-168" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPcs</span>(pca.result, <span class="at">type=</span><span class="st">&quot;loadings&quot;</span>, </span>
<span id="cb18-169"><a href="ExampleDust.html#cb18-169" aria-hidden="true" tabindex="-1"></a>        <span class="co">#col=as.numeric(sampclass(mtbls2Set))+1</span></span>
<span id="cb18-170"><a href="ExampleDust.html#cb18-170" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb18-171"><a href="ExampleDust.html#cb18-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-172"><a href="ExampleDust.html#cb18-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-173"><a href="ExampleDust.html#cb18-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-174"><a href="ExampleDust.html#cb18-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-175"><a href="ExampleDust.html#cb18-175" aria-hidden="true" tabindex="-1"></a><span class="co"># It is possible to use the retention time correction and grouping step in an iterative way if needed. </span></span>
<span id="cb18-176"><a href="ExampleDust.html#cb18-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Once you perform your last adjustRtime step and thus your last grouping step, you will obtain your final peak list (i.e. final list of ions)</span></span>
<span id="cb18-177"><a href="ExampleDust.html#cb18-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-178"><a href="ExampleDust.html#cb18-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-179"><a href="ExampleDust.html#cb18-179" aria-hidden="true" tabindex="-1"></a><span class="co">#----Annotation using CAMERA----#</span></span>
<span id="cb18-180"><a href="ExampleDust.html#cb18-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-181"><a href="ExampleDust.html#cb18-181" aria-hidden="true" tabindex="-1"></a><span class="co"># Since CAMERA has not yet been ported to XCMSnExp,we need to convert to xcmsSet. </span></span>
<span id="cb18-182"><a href="ExampleDust.html#cb18-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that the conversion only makes sense for somple XCMSnSets, </span></span>
<span id="cb18-183"><a href="ExampleDust.html#cb18-183" aria-hidden="true" tabindex="-1"></a><span class="co"># without e.g. MS level filtering (where CAMERA would then extract the wrong peaks)</span></span>
<span id="cb18-184"><a href="ExampleDust.html#cb18-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-185"><a href="ExampleDust.html#cb18-185" aria-hidden="true" tabindex="-1"></a>xs6 <span class="ot">&lt;-</span> <span class="fu">as</span>(xs5, <span class="st">&quot;xcmsSet&quot;</span>)</span>
<span id="cb18-186"><a href="ExampleDust.html#cb18-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-187"><a href="ExampleDust.html#cb18-187" aria-hidden="true" tabindex="-1"></a>xs6 <span class="ot">&lt;-</span> <span class="fu">xsAnnotate</span>(<span class="at">xs =</span> xs6, <span class="at">sample=</span><span class="cn">NA</span>, <span class="at">polarity =</span> <span class="st">&quot;positive&quot;</span>)</span>
<span id="cb18-188"><a href="ExampleDust.html#cb18-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-189"><a href="ExampleDust.html#cb18-189" aria-hidden="true" tabindex="-1"></a>xs7 <span class="ot">&lt;-</span> <span class="fu">groupFWHM</span>(xs6, <span class="at">sigma =</span> <span class="dv">6</span> , <span class="at">perfwhm =</span> <span class="dv">2</span>, <span class="at">intval =</span> <span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb18-190"><a href="ExampleDust.html#cb18-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-191"><a href="ExampleDust.html#cb18-191" aria-hidden="true" tabindex="-1"></a>xs8 <span class="ot">&lt;-</span> <span class="fu">groupCorr</span>(xs7, <span class="at">cor_eic_th =</span> <span class="fl">0.8</span>, <span class="at">calcCaS =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-192"><a href="ExampleDust.html#cb18-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-193"><a href="ExampleDust.html#cb18-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-194"><a href="ExampleDust.html#cb18-194" aria-hidden="true" tabindex="-1"></a><span class="co">#how many fragments need to be in a group for it to be included in the results. 5 - trace compounds; 20 - mostly high quality spectra</span></span>
<span id="cb18-195"><a href="ExampleDust.html#cb18-195" aria-hidden="true" tabindex="-1"></a>min.clustersize <span class="ot">&lt;-</span> <span class="dv">20</span> </span>
<span id="cb18-196"><a href="ExampleDust.html#cb18-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-197"><a href="ExampleDust.html#cb18-197" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;into&quot;</span>)</span>
<span id="cb18-198"><a href="ExampleDust.html#cb18-198" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(peaktable, <span class="at">file =</span> <span class="st">&quot;test_peaktable.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with all m/z features sorted into &quot;compounds&quot;</span></span>
<span id="cb18-199"><a href="ExampleDust.html#cb18-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-200"><a href="ExampleDust.html#cb18-200" aria-hidden="true" tabindex="-1"></a><span class="co">#the following script identifies all &quot;compounds&quot; considered too small according to min.clustersize</span></span>
<span id="cb18-201"><a href="ExampleDust.html#cb18-201" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> <span class="fu">getPeaklist</span>(xs8, <span class="at">intval=</span><span class="st">&quot;maxo&quot;</span>)</span>
<span id="cb18-202"><a href="ExampleDust.html#cb18-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-203"><a href="ExampleDust.html#cb18-203" aria-hidden="true" tabindex="-1"></a><span class="co"># Replaces NA in intensities with zero</span></span>
<span id="cb18-204"><a href="ExampleDust.html#cb18-204" aria-hidden="true" tabindex="-1"></a>peaktable <span class="ot">&lt;-</span> peaktable <span class="sc">%&gt;%</span></span>
<span id="cb18-205"><a href="ExampleDust.html#cb18-205" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;X&quot;</span>), <span class="sc">~</span>tidyr<span class="sc">::</span><span class="fu">replace_na</span>(., <span class="dv">0</span>)))</span>
<span id="cb18-206"><a href="ExampleDust.html#cb18-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-207"><a href="ExampleDust.html#cb18-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-208"><a href="ExampleDust.html#cb18-208" aria-hidden="true" tabindex="-1"></a>pcgroups <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.numeric</span>(peaktable<span class="sc">$</span>pcgroup)))</span>
<span id="cb18-209"><a href="ExampleDust.html#cb18-209" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-210"><a href="ExampleDust.html#cb18-210" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-211"><a href="ExampleDust.html#cb18-211" aria-hidden="true" tabindex="-1"></a>small.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-212"><a href="ExampleDust.html#cb18-212" aria-hidden="true" tabindex="-1"></a>big.clusters <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-213"><a href="ExampleDust.html#cb18-213" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb18-214"><a href="ExampleDust.html#cb18-214" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="fu">seq_along</span>(pcgroups)) {</span>
<span id="cb18-215"><a href="ExampleDust.html#cb18-215" aria-hidden="true" tabindex="-1"></a>  clustersize <span class="ot">&lt;-</span> <span class="fu">length</span>(peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,<span class="fu">ncol</span>(peaktable)])</span>
<span id="cb18-216"><a href="ExampleDust.html#cb18-216" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(clustersize <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(min.clustersize))</span>
<span id="cb18-217"><a href="ExampleDust.html#cb18-217" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb18-218"><a href="ExampleDust.html#cb18-218" aria-hidden="true" tabindex="-1"></a>    small.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(small.clusters, x)</span>
<span id="cb18-219"><a href="ExampleDust.html#cb18-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-220"><a href="ExampleDust.html#cb18-220" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span></span>
<span id="cb18-221"><a href="ExampleDust.html#cb18-221" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb18-222"><a href="ExampleDust.html#cb18-222" aria-hidden="true" tabindex="-1"></a>    big.clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(big.clusters, x)</span>
<span id="cb18-223"><a href="ExampleDust.html#cb18-223" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> peaktable[peaktable<span class="sc">$</span>pcgroup<span class="sc">==</span>x,]</span>
<span id="cb18-224"><a href="ExampleDust.html#cb18-224" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="dv">2</span><span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">3</span><span class="sc">-</span>(<span class="fu">length</span>(mzXMLfiles))))]</span>
<span id="cb18-225"><a href="ExampleDust.html#cb18-225" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> gruppe1[, <span class="sc">-</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">:</span>(<span class="fu">ncol</span>(gruppe1)<span class="sc">-</span><span class="dv">2</span>))]</span>
<span id="cb18-226"><a href="ExampleDust.html#cb18-226" aria-hidden="true" tabindex="-1"></a>    decider <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb18-227"><a href="ExampleDust.html#cb18-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-228"><a href="ExampleDust.html#cb18-228" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(gruppe1))</span>
<span id="cb18-229"><a href="ExampleDust.html#cb18-229" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb18-230"><a href="ExampleDust.html#cb18-230" aria-hidden="true" tabindex="-1"></a>      decider <span class="ot">&lt;-</span> <span class="fu">c</span>(decider, <span class="fu">sum</span>(gruppe1[, i]))</span>
<span id="cb18-231"><a href="ExampleDust.html#cb18-231" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-232"><a href="ExampleDust.html#cb18-232" aria-hidden="true" tabindex="-1"></a>    highest <span class="ot">&lt;-</span> <span class="fu">which</span>(decider<span class="sc">==</span><span class="fu">max</span>(decider), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-233"><a href="ExampleDust.html#cb18-233" aria-hidden="true" tabindex="-1"></a>    gruppe1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(gruppe1[, <span class="dv">1</span>], gruppe1[, highest[<span class="dv">1</span>]<span class="sc">+</span><span class="dv">1</span>])</span>
<span id="cb18-234"><a href="ExampleDust.html#cb18-234" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(gruppe1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mz&quot;</span>, <span class="st">&quot;int&quot;</span>)</span>
<span id="cb18-235"><a href="ExampleDust.html#cb18-235" aria-hidden="true" tabindex="-1"></a>    lspectra[[n]] <span class="ot">&lt;-</span> gruppe1</span>
<span id="cb18-236"><a href="ExampleDust.html#cb18-236" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">&lt;-</span> n<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb18-237"><a href="ExampleDust.html#cb18-237" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-238"><a href="ExampleDust.html#cb18-238" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-239"><a href="ExampleDust.html#cb18-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-240"><a href="ExampleDust.html#cb18-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-241"><a href="ExampleDust.html#cb18-241" aria-hidden="true" tabindex="-1"></a><span class="co"># remove peaks with zero intensities</span></span>
<span id="cb18-242"><a href="ExampleDust.html#cb18-242" aria-hidden="true" tabindex="-1"></a>lspectra <span class="ot">&lt;-</span> <span class="fu">lapply</span>(lspectra, <span class="cf">function</span>(x) {x[x<span class="sc">$</span>int <span class="sc">!=</span> <span class="dv">0</span>,]})</span>
<span id="cb18-243"><a href="ExampleDust.html#cb18-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-244"><a href="ExampleDust.html#cb18-244" aria-hidden="true" tabindex="-1"></a>reduced.peaktable <span class="ot">&lt;-</span> <span class="fu">getReducedPeaklist</span>(xs8, <span class="at">method =</span> <span class="st">&quot;sum&quot;</span>, <span class="at">intval =</span> <span class="st">&quot;into&quot;</span>, <span class="at">default.adduct.info =</span> <span class="st">&quot;maxint&quot;</span>, <span class="at">mzrt.range =</span> <span class="cn">FALSE</span>, <span class="at">npeaks.sum =</span> <span class="cn">FALSE</span>, <span class="at">cleanup =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-245"><a href="ExampleDust.html#cb18-245" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">is.null</span>(small.clusters)<span class="sc">==</span><span class="cn">FALSE</span>) {</span>
<span id="cb18-246"><a href="ExampleDust.html#cb18-246" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(z <span class="cf">in</span> small.clusters)</span>
<span id="cb18-247"><a href="ExampleDust.html#cb18-247" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb18-248"><a href="ExampleDust.html#cb18-248" aria-hidden="true" tabindex="-1"></a>    reduced.peaktable <span class="ot">&lt;-</span> reduced.peaktable[<span class="sc">-</span>(<span class="fu">which</span>(reduced.peaktable[, <span class="fu">ncol</span>(reduced.peaktable)]<span class="sc">==</span>z)), ]</span>
<span id="cb18-249"><a href="ExampleDust.html#cb18-249" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-250"><a href="ExampleDust.html#cb18-250" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-251"><a href="ExampleDust.html#cb18-251" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(reduced.peaktable, <span class="at">file =</span> <span class="st">&quot;test_peaktable.csv&quot;</span>) <span class="co">#This creates a peaktable .csv file with only &quot;compounds&quot; instead of m/z features</span></span>
<span id="cb18-252"><a href="ExampleDust.html#cb18-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-253"><a href="ExampleDust.html#cb18-253" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Name =</span> <span class="fu">paste</span>(<span class="st">&quot;Unknown&quot;</span>, big.clusters, <span class="st">&quot;RT =&quot;</span>,<span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>) ), <span class="at">Class =</span> <span class="st">&quot;Unknown&quot;</span>, <span class="at">RT =</span> <span class="fu">round</span>(reduced.peaktable<span class="sc">$</span>rt<span class="sc">/</span><span class="dv">60</span>, <span class="dv">2</span>),  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-254"><a href="ExampleDust.html#cb18-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-255"><a href="ExampleDust.html#cb18-255" aria-hidden="true" tabindex="-1"></a><span class="do">####KOVATS#####</span></span>
<span id="cb18-256"><a href="ExampleDust.html#cb18-256" aria-hidden="true" tabindex="-1"></a><span class="co">#Adding Kovats retention index to the extra obejct to write to msp</span></span>
<span id="cb18-257"><a href="ExampleDust.html#cb18-257" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">rt =</span> extra<span class="sc">$</span>RT)</span>
<span id="cb18-258"><a href="ExampleDust.html#cb18-258" aria-hidden="true" tabindex="-1"></a>alkaneSeries <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Num =</span> <span class="fu">c</span>(<span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">17</span>, <span class="dv">19</span>, <span class="dv">21</span>, <span class="dv">23</span>, <span class="dv">25</span>),</span>
<span id="cb18-259"><a href="ExampleDust.html#cb18-259" aria-hidden="true" tabindex="-1"></a>                           <span class="at">rt =</span> <span class="fu">c</span>(<span class="fl">4.90</span>, <span class="fl">8.00</span>, <span class="fl">11.13</span>, <span class="fl">14.05</span>, <span class="fl">16.70</span>, <span class="fl">19.37</span>, <span class="fl">22.45</span>, <span class="fl">25.77</span>))</span>
<span id="cb18-260"><a href="ExampleDust.html#cb18-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-261"><a href="ExampleDust.html#cb18-261" aria-hidden="true" tabindex="-1"></a>RI <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">length =</span> <span class="fu">nrow</span>(data))</span>
<span id="cb18-262"><a href="ExampleDust.html#cb18-262" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data))) {</span>
<span id="cb18-263"><a href="ExampleDust.html#cb18-263" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb18-264"><a href="ExampleDust.html#cb18-264" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">1</span>],</span>
<span id="cb18-265"><a href="ExampleDust.html#cb18-265" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb18-266"><a href="ExampleDust.html#cb18-266" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb18-267"><a href="ExampleDust.html#cb18-267" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb18-268"><a href="ExampleDust.html#cb18-268" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb18-269"><a href="ExampleDust.html#cb18-269" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb18-270"><a href="ExampleDust.html#cb18-270" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>]</span>
<span id="cb18-271"><a href="ExampleDust.html#cb18-271" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-272"><a href="ExampleDust.html#cb18-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-273"><a href="ExampleDust.html#cb18-273" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb18-274"><a href="ExampleDust.html#cb18-274" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">1</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">2</span>],</span>
<span id="cb18-275"><a href="ExampleDust.html#cb18-275" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">2</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">3</span>],</span>
<span id="cb18-276"><a href="ExampleDust.html#cb18-276" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">3</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">4</span>],</span>
<span id="cb18-277"><a href="ExampleDust.html#cb18-277" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">4</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">5</span>],</span>
<span id="cb18-278"><a href="ExampleDust.html#cb18-278" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">5</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">6</span>],</span>
<span id="cb18-279"><a href="ExampleDust.html#cb18-279" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">6</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">7</span>],</span>
<span id="cb18-280"><a href="ExampleDust.html#cb18-280" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>rt[i] <span class="sc">&gt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">7</span>] <span class="sc">&amp;</span> data<span class="sc">$</span>rt[i] <span class="sc">&lt;=</span> alkaneSeries<span class="sc">$</span>rt[<span class="dv">8</span>] <span class="sc">~</span> alkaneSeries<span class="sc">$</span>Num[<span class="dv">8</span>]</span>
<span id="cb18-281"><a href="ExampleDust.html#cb18-281" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-282"><a href="ExampleDust.html#cb18-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-283"><a href="ExampleDust.html#cb18-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-284"><a href="ExampleDust.html#cb18-284" aria-hidden="true" tabindex="-1"></a>RI[i] <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span><span class="sc">*</span>n <span class="sc">+</span> <span class="dv">100</span><span class="sc">*</span>(m<span class="sc">-</span>n) <span class="sc">*</span> (data<span class="sc">$</span>rt[i] <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt)<span class="sc">/</span>(alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> m,]<span class="sc">$</span>rt <span class="sc">-</span> alkaneSeries[alkaneSeries<span class="sc">$</span>Num <span class="sc">==</span> n,]<span class="sc">$</span>rt), <span class="dv">0</span>)</span>
<span id="cb18-285"><a href="ExampleDust.html#cb18-285" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-286"><a href="ExampleDust.html#cb18-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-287"><a href="ExampleDust.html#cb18-287" aria-hidden="true" tabindex="-1"></a>extra <span class="ot">&lt;-</span> <span class="fu">cbind</span>(extra, RI)</span>
<span id="cb18-288"><a href="ExampleDust.html#cb18-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-289"><a href="ExampleDust.html#cb18-289" aria-hidden="true" tabindex="-1"></a><span class="do">######</span><span class="re">END</span><span class="do"> KOVATS######</span></span>
<span id="cb18-290"><a href="ExampleDust.html#cb18-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-291"><a href="ExampleDust.html#cb18-291" aria-hidden="true" tabindex="-1"></a><span class="co"># create the msp object with spectra and all meta information in the extra object (NAME, RETENTIONTIME, RETENTIONINDEX)</span></span>
<span id="cb18-292"><a href="ExampleDust.html#cb18-292" aria-hidden="true" tabindex="-1"></a>export.msp <span class="ot">&lt;-</span> <span class="fu">construct.msp</span>(lspectra, extra)</span>
<span id="cb18-293"><a href="ExampleDust.html#cb18-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-294"><a href="ExampleDust.html#cb18-294" aria-hidden="true" tabindex="-1"></a><span class="fu">write.msp</span>(export.msp, <span class="at">file =</span> <span class="st">&quot;test_spectra.msp&quot;</span>) <span class="co">#This creates a NIST MS Search compatible .msp file with all compound pseudospectra</span></span></code></pre></div>
</div>
<div id="lc-hrms-using-waters-mse-dia-workflow" class="section level2 hasAnchor" number="11.2">
<h2><span class="header-section-number">11.2</span> LC-HRMS using Waters MSe DIA workflow<a href="ExampleDust.html#lc-hrms-using-waters-mse-dia-workflow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2" class="section level2 hasAnchor" number="11.3">
<h2><span class="header-section-number">11.3</span> Workflow for centroiding of raw file, peak picking and correlation of MS1 and MS2<a href="ExampleDust.html#workflow-for-centroiding-of-raw-file-peak-picking-and-correlation-of-ms1-and-ms2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="first-convert-unifi-data-using-msconvert" class="section level2 hasAnchor" number="11.4">
<h2><span class="header-section-number">11.4</span> First convert unifi data using MSConvert<a href="ExampleDust.html#first-convert-unifi-data-using-msconvert" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Options:
output format: mzML<br />
binary encoding precision: 64-bit<br />
Write index: check<br />
TPP compatibility: check<br />
use zlib compression: uncheck<br />
package in gzip: uncheck</p>
<p>Filters:<br />
1. TitleMaker<br />
2. msLevel: 1-2 (need to click “Add” to add filter)</p>
</div>
<div id="centroiding-raw-data-from-mzml-using-msnbase" class="section level2 hasAnchor" number="11.5">
<h2><span class="header-section-number">11.5</span> Centroiding raw data from mzML using MSnbase<a href="ExampleDust.html#centroiding-raw-data-from-mzml-using-msnbase" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PostProcessing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ExamplePFAS.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown/edit/master/inst/examples/11-Example_Dust.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SSANTA.pdf", "SSANTA.epub", "SSANTA.mobi"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
